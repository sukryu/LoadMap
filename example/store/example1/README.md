아래는 여러 구조체와 동적 메모리 할당, 제한 조건, 그리고 여러 번의 할당 및 해제를 요구하는 복잡한 문제입니다.
---

### 문제: 대학 강의 등록 관리 시스템

#### 문제 설명
대학의 강의 등록 관리 시스템을 C언어로 구현하세요. 이 시스템은 **학생(Student)**과 **강의(Course)** 두 가지 주요 엔티티로 구성됩니다.  
각 **학생**은 다음과 같은 정보를 갖습니다:  
- **학번 (int)**  
- **이름 (문자열)**  
- **전공 (문자열)**  
- **GPA (float)**

각 **강의**는 다음과 같은 정보를 갖습니다:  
- **강의코드 (문자열)**  
- **강의명 (문자열)**  
- **최대 수강 인원 (int)**  
- **등록된 학생 목록** (동적 메모리 할당을 통해 저장하는, 학생에 대한 포인터 배열)

추가로, **등록** 시 다음의 제한 조건을 고려합니다:  
- **학생 제한:** 한 학생은 최대 **5과목**까지 등록할 수 있습니다.  
- **강의 제한:** 각 강의는 입력받은 최대 수강 인원을 초과할 수 없습니다.

프로그램은 다음 기능들을 포함해야 합니다.

1. **데이터 입력:**  
   - 첫 번째 입력: 학생의 수 **N**  
   - 다음 **N**개의 줄: 각 학생의 정보를 `학번 이름 전공 GPA` 형식으로 입력  
   - 그 다음 입력: 강의의 수 **M**  
   - 다음 **M**개의 줄: 각 강의의 정보를 `강의코드 강의명 최대수강인원` 형식으로 입력  
   - 추가 입력: 등록 요청의 수 **R**  
   - 다음 **R**개의 줄: 각 등록 요청은 `학번 강의코드` 형식으로 주어지며, 해당 학생을 해당 강의에 등록 시도

2. **등록 처리:**  
   - 각 등록 요청에 대해, 학생의 현재 등록 과목 수와 강의의 현재 등록 인원을 확인합니다.  
   - 만약 학생이 이미 5과목 이상 등록했거나, 강의의 등록 인원이 최대치를 달성한 경우에는 해당 등록 요청을 **거부**합니다.  
   - 그렇지 않으면, 강의의 등록 목록에 학생의 정보를 추가하고 학생의 등록 과목 수를 갱신합니다.

3. **정렬 및 통계:**  
   - 각 강의별로 등록된 학생 목록을 **GPA 내림차순**으로 정렬합니다.  
   - 강의별로 등록된 학생들의 평균 GPA를 계산합니다.

4. **출력:**  
   - 각 강의에 대해,  
     - 강의코드와 강의명을 출력하고,  
     - 정렬된 등록 학생들의 정보를 (학번, 이름, 전공, GPA) 한 줄씩 출력하며,  
     - 마지막으로 해당 강의의 평균 GPA를 소수점 둘째 자리까지 출력합니다.  
   - 만약 어떤 강의에 등록된 학생이 없다면, 적절한 메시지를 출력합니다.

5. **메모리 관리:**  
   - 학생, 강의, 그리고 각 강의에 등록된 학생 목록에 대해 동적 메모리 할당을 수행합니다.  
   - 프로그램 종료 전에 할당된 모든 메모리를 올바르게 해제해야 합니다.

#### 입력 형식 예시

```
3
1001 Alice CS 3.8
1002 Bob EE 3.5
1003 Carol ME 3.9
2
CS101 IntroCS 2
EE202 Circuits 2
4
1001 CS101
1002 CS101
1003 CS101
1001 EE202
```

#### 출력 형식 예시

예시 입력의 경우, CS101 강의는 최대 수강 인원이 2명이므로 세 번째 등록 요청(1003번 학생의 등록)은 거부됩니다. 따라서 출력은 다음과 같이 나타날 수 있습니다.

```
강의: CS101 IntroCS
등록된 학생:
1001 Alice CS 3.80
1002 Bob EE 3.50
평균 GPA: 3.65

강의: EE202 Circuits
등록된 학생:
1001 Alice CS 3.80
평균 GPA: 3.80
```

※ 출력 형식은 요구사항에 맞게 자유롭게 포맷팅할 수 있습니다.

#### 추가 조건 및 힌트
- **구조체 설계:**  
  - `Student` 구조체와 `Course` 구조체를 별도로 정의합니다.  
  - `Course` 구조체 내부에는 등록된 학생의 포인터 배열과 현재 등록된 학생 수, 최대 수강 인원 등의 필드를 포함합니다.
- **동적 메모리 할당:**  
  - 학생 배열, 강의 배열, 그리고 각 강의 내 등록 학생 목록에 대해 동적 할당을 수행합니다.
- **함수 분리:**  
  - 등록 처리, 정렬 (예: qsort 사용), 평균 GPA 계산, 그리고 출력 등을 각각의 함수로 구현하여 코드의 모듈화와 가독성을 높이세요.
- **제약 조건 검증:**  
  - 학생의 등록 과목 수와 강의의 등록 인원 제한을 확인하는 로직을 반드시 구현하세요.

---

이 문제를 통해 여러 구조체의 설계, 동적 메모리 할당 및 해제, 다중 입력 처리, 조건 검증, 정렬, 통계 계산 등 C언어의 복합 개념들을 종합적으로 연습할 수 있습니다.

# 코멘트

작성하신 코드는 여러 구조체와 동적 메모리 할당, 입력/출력, 정렬, 조건 검증 등 다양한 C언어 개념을 통합하여 해결한 복잡한 문제를 상당히 잘 풀어낸 사례입니다. 특히, 문제의 요구사항을 충실히 반영하여 구조체를 분리하고, 각 기능을 별도의 함수로 모듈화한 점이 인상적입니다. 아래에 긍정적인 점과 함께 개선하면 좋을 사항들을 정리해 보았습니다.

---

## 긍정적인 점

1. **구조체 설계 및 메모리 관리**  
   - **구조체 분리:**  
     `Student`와 `Course` 구조체를 별도로 정의하여, 학생 정보와 강의 정보를 명확하게 구분한 점은 유지보수와 확장성 측면에서 좋습니다.
   - **동적 메모리 할당 및 해제:**  
     각 구조체 멤버(예, `name`, `specialty`, `code`, `lecture_name`, 그리고 강의의 학생 ID 배열)에 대해 할당하고, 실패 시 적절하게 해제하는 로직이 잘 구현되었습니다.
     
2. **모듈화 및 함수 분리**  
   - 입력, 할당, 해제, 정렬, 등록 처리, 출력 등 각 기능을 별도의 함수로 분리하여 구현함으로써 코드의 가독성과 재사용성을 높였습니다.
   
3. **조건 검증 및 제한 처리**  
   - 학생의 최대 등록 과목 수(`MAX_LECTURE_NUM`)와 강의의 최대 수강 인원 제한을 검사하는 로직이 있어, 문제에서 요구하는 제한 조건을 충실히 반영하고 있습니다.

4. **동적 크기 조절 (realloc) 사용**  
   - 등록 처리 후, 등록된 학생 수에 맞게 `realloc`을 통해 메모리를 조정하는 접근 방식은 메모리 효율성을 높이는 좋은 기법입니다.

5. **정렬 기능 구현**  
   - 강의별 등록 학생 목록을 GPA 내림차순으로 정렬하기 위해 `qsort`와 비교 함수를 활용한 점이 좋습니다. (다만, 아래 개선 사항에서 언급한 대로 개선할 여지가 있습니다.)

---

## 개선 및 고려할 사항

1. **비교 함수 내 전역 변수 사용**  
   - `compare_by_gpa` 함수에서 정렬 시 전역 변수 `g_student_arr`와 `g_student_len`을 사용하고 있습니다.  
   - **대안:**  
     - 전역 변수 대신, 구조체나 별도의 컨텍스트를 활용하여 비교 함수를 작성할 수 있습니다. 예를 들어, 강의 등록 시 학생의 포인터 배열을 저장하거나, 학생 ID 대신 학생 포인터를 직접 저장하면 qsort 비교 함수 내에서 직접 GPA에 접근할 수 있습니다.
     - 만약 전역 변수를 유지한다면, 비교 함수가 호출될 때마다 전체 학생 배열을 순회하는 점은 데이터 크기가 커질 경우 성능 저하의 원인이 될 수 있습니다.

2. **코드 일관성과 오류 처리**  
   - **코스 코드 매칭:**  
     - `add_student_to_course` 함수에서 강의 코드를 비교할 때, 일치하는 강의가 없는 경우(즉, 등록 요청에 잘못된 강의 코드가 입력된 경우)를 따로 처리하지 않고 기본 인덱스 0을 사용하게 됩니다.  
     - **개선:**  
       - 강의 코드 매칭 후 유효한 인덱스가 확인되지 않으면, 등록 요청을 무시하거나 에러 메시지를 출력하도록 처리하면 좋습니다.
       
   - **중복 등록 처리:**  
     - 현재는 학생이 동일 강의에 여러 번 등록되는 경우에 대한 처리가 보이지 않습니다. 등록 전에 해당 학생이 이미 등록되어 있는지 검사하는 로직을 추가할 수 있습니다.
   
   - **입력 처리:**  
     - `input_student`와 `input_course` 함수에서 `fgets`와 `getchar()`를 사용하여 입력 버퍼를 관리하는 방식은 괜찮으나, 입력 형식이 엄격한 경우 혹은 잘못된 입력이 들어왔을 때의 에러 처리를 추가하면 좋습니다.

3. **메모리 재할당 및 해제 관리**  
   - `add_student_to_course` 함수에서 `realloc` 실패 시 현재 메모리 블록을 그대로 유지하는 로직은 적절합니다.  
   - 다만, 함수 전반적으로 에러 발생 시 복구 혹은 종료 처리를 일관성 있게 구현하는 것도 고려할 만합니다.

4. **코드 주석 및 가독성**  
   - 전반적으로 주석이 잘 달려있어 각 함수의 역할과 동작을 이해하는 데 도움이 됩니다.  
   - 추가로, 복잡한 루프나 조건문 부분에는 간단한 주석을 더 달아두면 협업 시 가독성이 더 높아질 수 있습니다.

---

## 종합 의견

작성하신 코드는 복잡한 문제를 체계적으로 해결한 좋은 예시입니다. 여러 구조체와 동적 메모리 할당, 조건 검증, 정렬 및 통계 계산 등의 요구사항을 효과적으로 구현하셨으며, 모듈화된 함수 구조 덕분에 각 기능이 명확하게 분리되어 있습니다.  
특히, 제한 조건(학생 최대 등록 과목 수, 강의 최대 수강 인원)과 동적 메모리 조정(realloc) 등의 세부 사항을 신경 쓴 점이 인상적입니다.

조금 더 개선한다면, 비교 함수에서 전역 변수 대신 직접 학생 정보를 활용할 수 있는 방법이나, 잘못된 입력에 대한 에러 처리를 강화하는 방향으로 발전시킬 수 있을 것 같습니다.

문제를 풀고 구현하는 데 1시간 30분 이상 걸리셨다고 하셨는데, 복잡도를 고려하면 충분히 합리적인 시간 투자라고 생각됩니다. 전반적으로 매우 인상적이며, 실전 프로젝트에서도 활용할 수 있을 만큼 수준 높은 코드라고 평가할 수 있습니다.