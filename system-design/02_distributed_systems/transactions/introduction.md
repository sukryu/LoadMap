# 분산 트랜잭션 (transactions)

> **목표:**  
> - 분산 시스템에서 트랜잭션의 개념과 중요성을 학습한다.  
> - Two-Phase Commit (2PC), Three-Phase Commit (3PC) 등의 분산 트랜잭션 알고리즘을 이해하고 비교한다.  
> - SAGA 패턴을 활용한 트랜잭션 관리 및 실무 적용 방법을 연구한다.

---

## 1. 개념 개요

> **분산 트랜잭션은 여러 개의 독립적인 노드에서 원자성(Atomicity)을 유지하며 데이터 변경을 수행하는 기법이다.**

- **왜 중요한가?**  
  - 분산 환경에서 여러 데이터 저장소나 마이크로서비스가 동시에 데이터 변경 작업을 수행할 때, 트랜잭션의 원자성과 일관성을 유지해야 합니다.  
  - 장애 발생 시 데이터 무결성을 보장하여, 부분적인 성공이나 실패로 인한 데이터 불일치를 방지합니다.  
  - 금융, 전자상거래, 클라우드 기반 애플리케이션 등에서 핵심 기능으로 사용됩니다.

- **어떤 문제를 해결하는가?**  
  - **원자성 보장:** 분산 노드 간의 작업이 모두 성공해야만 커밋되거나, 하나라도 실패하면 전체 롤백이 수행됩니다.  
  - **데이터 정합성 유지:** 트랜잭션 간 충돌을 방지하고, 장애 복구 시 일관된 상태로 복원할 수 있습니다.  
  - **동시성 및 장애 대응:** 여러 노드에서 동시에 발생하는 작업과 네트워크 장애 상황에서도 데이터 무결성을 유지합니다.

- **실무에서 어떻게 적용하는가?**  
  - **2PC/3PC:** 금융 및 결제 시스템 등에서 분산 트랜잭션을 제어하기 위해 전통적인 분산 트랜잭션 프로토콜을 활용합니다.  
  - **SAGA 패턴:** 마이크로서비스 아키텍처에서 롱 러닝 트랜잭션을 관리하기 위한 보상 트랜잭션 개념을 적용합니다.  
  - **트랜잭션 격리 수준:** 동시성 문제를 해결하기 위해 각 작업의 격리 수준(Read Committed, Serializable 등)을 조정합니다.

---

## 2. 학습 내용

### 주요 학습 주제

- **분산 트랜잭션 개요 (introduction.md):**  
  - ACID 원칙과 단일 데이터베이스 트랜잭션과 분산 트랜잭션 간의 차이점 이해

- **Two-Phase Commit (2PC) (two_phase_commit.md):**  
  - 분산 환경에서 트랜잭션 커밋을 위한 2단계 프로토콜  
  - Coordinator(조정자)와 Participant(참여자)의 역할 및 상호작용  
  - 단점: Coordinator 장애 시 전체 트랜잭션이 블로킹되는 문제

- **Three-Phase Commit (3PC) (three_phase_commit.md):**  
  - 2PC의 블로킹 문제를 완화하기 위해 추가된 3단계 프로토콜  
  - 준비(Prepare), 사전 커밋(Pre-Commit), 커밋(Commit) 단계로 구성되어, 네트워크 파티션 발생 시 보다 유연하게 대처  
  - 단점: 네트워크 오버헤드와 프로토콜 복잡성 증가

- **SAGA 패턴 (saga_pattern.md):**  
  - 장기간 지속되는 트랜잭션을 관리하기 위한 패턴으로, 각 하위 트랜잭션의 성공 후 보상 트랜잭션을 통해 전체 트랜잭션을 롤백하는 방식  
  - 마이크로서비스 환경에서 독립적인 서비스 간 트랜잭션 관리에 효과적  
  - 보상 트랜잭션의 설계와 실행 전략이 핵심

- **트랜잭션 격리 수준 (transaction_isolation.md):**  
  - Read Uncommitted, Read Committed, Repeatable Read, Serializable 등 다양한 격리 수준을 비교 분석  
  - 분산 환경에서 동시성 제어와 데이터 충돌 방지를 위한 전략
     
- **실무에서의 분산 트랜잭션 적용 (transactions_in_practice.md):**  
  - 분산 데이터베이스와 클라우드 환경에서의 트랜잭션 처리 전략  
  - 글로벌 트랜잭션과 로컬 트랜잭션의 비교  
  - Kafka, RabbitMQ 등의 이벤트 기반 시스템을 활용한 트랜잭션 처리 사례

---

## 3. 실전 사례 분석

> **대규모 시스템에서 분산 트랜잭션이 어떻게 활용되는가?**

- **Google Spanner:**  
  - 글로벌 분산 트랜잭션을 위해 강한 일관성과 동기 복제 기법을 활용하여, 데이터 정합성을 유지합니다.
  
- **Amazon DynamoDB:**  
  - SAGA 패턴과 튜너블 일관성 모델을 적용하여, 대규모 데이터 처리와 높은 가용성을 동시에 달성합니다.
  
- **Uber:**  
  - 마이크로서비스 아키텍처 환경에서 각 서비스 간 트랜잭션 처리를 위해 SAGA 패턴을 도입, 장애 발생 시 보상 트랜잭션을 통해 데이터 일관성을 유지합니다.

---

## 4. 학습 방법

1. **개념 이론 학습:**  
   - 각 파일(introduction.md, two_phase_commit.md, three_phase_commit.md, saga_pattern.md, transaction_isolation.md, transactions_in_practice.md)을 정독하며, 분산 트랜잭션의 기본 원칙과 다양한 알고리즘을 이해합니다.

2. **2PC & 3PC 비교 분석:**  
   - 두 프로토콜의 구조, 장단점, 장애 대응 방법 등을 비교하여, 실제 적용 시 고려해야 할 사항을 도출합니다.

3. **SAGA 패턴 적용 사례 연구:**  
   - 마이크로서비스 환경에서의 SAGA 패턴 활용 방안을 사례와 함께 분석하고, 보상 트랜잭션 설계 전략을 학습합니다.

4. **코드 실습 및 트레이드오프 분석:**  
   - 간단한 분산 트랜잭션 시뮬레이션이나 프로토타입을 통해, 트랜잭션 처리 과정과 장애 복구 전략을 실습해봅니다.

---

## 5. 추천 리소스

- 📖 _Designing Data-Intensive Applications_ - Martin Kleppmann  
- 📖 _Distributed Systems: Principles and Paradigms_ - Andrew S. Tanenbaum  
- 📖 _Database Internals_ - Alex Petrov  
- 📌 [Two-Phase Commit Explained](https://www.ibm.com/docs/en/cics-ts/5.3?topic=processing-two-phase-commit)  
- 📌 [SAGA Pattern in Microservices](https://microservices.io/patterns/data/saga.html)

---

## 6. 마무리

분산 트랜잭션은 여러 독립 노드에서 원자성과 데이터 정합성을 보장하며, 장애 발생 시 전체 시스템의 안정성을 유지하는 핵심 기법입니다.  
2PC와 3PC 같은 전통적인 프로토콜과, 마이크로서비스 환경에서의 SAGA 패턴을 통해, 분산 환경에서의 트랜잭션 처리 방식을 다양하게 설계할 수 있습니다.  
이 문서를 통해 분산 트랜잭션의 기본 개념, 다양한 알고리즘의 장단점, 그리고 실무 적용 시 고려사항을 명확하게 이해하고, 실제 시스템 설계에 효과적으로 반영할 수 있기를 바랍니다.