# 장애 모델 및 장애 대응 전략

> **목표:**  
> - 분산 시스템 환경에서 발생할 수 있는 다양한 장애 모델(예: Fail-stop, Byzantine 등)을 이해한다.  
> - 장애 감지, 페일오버, 로드 밸런싱, 재시도 등 장애 대응 전략을 학습하여 실무에 적용한다.  
> - 장애 발생 시 시스템의 신뢰성과 가용성을 유지하기 위한 설계 원칙과 운영 방안을 마련한다.

---

## 1. 개념 개요

분산 시스템에서는 여러 노드 간의 통신 및 데이터 동기화 과정에서 다양한 장애가 발생할 수 있습니다. 장애 모델은 이러한 상황을 가정하여 시스템 설계 시 고려해야 할 기준을 제시하며, 장애 대응 전략은 실제 운영 환경에서 장애를 신속하게 감지하고 복구하기 위한 방법론을 포함합니다.

- **왜 중요한가?**  
  - 장애는 분산 시스템의 안정성과 신뢰성에 큰 영향을 미치므로, 장애에 대비한 설계와 운영 전략이 필수적입니다.
  - 효과적인 장애 대응 전략은 서비스 중단을 최소화하고, 빠른 복구를 통해 사용자 경험을 보호할 수 있습니다.

- **어떤 문제를 해결하는가?**  
  - 단일 장애점(Single Point of Failure, SPOF)을 제거하고, 노드 장애 시에도 전체 시스템이 지속적으로 동작하도록 합니다.
  - 네트워크 파티션, 데이터 불일치, 시스템 과부하 등 장애 상황에서 데이터 손실 및 서비스 중단을 방지합니다.

---

## 2. 주요 장애 모델

### 2.1 Fail-stop 모델
- **정의:**  
  - 노드가 장애 발생 시 즉시 정지하며, 이를 주변 시스템에 명확하게 알리는 모델입니다.
- **특징:**  
  - 장애가 발생한 노드에 대해 예측 가능한 행동을 보이므로, 장애 감지와 대응이 상대적으로 용이합니다.
- **적용 사례:**  
  - 서버가 명시적으로 “죽음”을 알리는 환경, 예를 들어 헬스 체크를 통한 장애 감지 시스템.

### 2.2 Byzantine 장애 모델
- **정의:**  
  - 노드가 비정상적인 동작을 하거나, 잘못된 정보를 제공하는 등 예측하기 어려운 방식으로 장애가 발생하는 상황을 가정합니다.
- **특징:**  
  - 단순한 정지 모델과 달리, 잘못된 데이터 전송이나 악의적인 행위가 포함될 수 있어 장애 감지가 복잡합니다.
- **적용 사례:**  
  - 블록체인 네트워크, 보안에 민감한 분산 시스템 등에서 Byzantine Fault Tolerance (BFT) 알고리즘 적용.

### 2.3 네트워크 파티션
- **정의:**  
  - 네트워크의 일부가 분리되어 노드 간 통신이 불가능한 상태입니다.
- **특징:**  
  - 파티션 상황에서는 데이터 일관성 및 가용성 사이의 트레이드오프가 발생합니다.
- **실무 고려:**  
  - CAP 이론을 바탕으로 파티션 상황에서 어떤 속성을 우선할지 결정.

---

## 3. 장애 대응 전략

### 3.1 장애 감지 (Failure Detection)
- **헬스 체크(Health Check):**  
  - 주기적으로 각 노드의 상태를 확인하는 방법으로, HTTP 요청, ICMP(Ping) 등을 활용.
- **모니터링 도구:**  
  - Prometheus, Grafana, ELK 스택 등을 사용하여 실시간 로그 및 성능 지표를 수집하고, 이상 징후를 감지.

### 3.2 페일오버 (Failover)
- **정의:**  
  - 장애 발생 시 자동으로 대체 노드나 백업 시스템으로 트래픽을 전환하는 방식입니다.
- **실무 적용:**  
  - 로드 밸런서를 통한 페일오버, 클러스터링 및 리플리케이션 전략 활용.

### 3.3 재시도 및 타임아웃 (Retry and Timeout)
- **재시도 전략:**  
  - 일시적인 장애에 대비하여, 요청 실패 시 재시도를 통해 문제를 해결.
- **타임아웃:**  
  - 응답 지연 시 일정 시간 후 요청을 중단하여, 전체 시스템의 지연을 방지.

### 3.4 장애 복구 및 데이터 복제 (Recovery and Data Replication)
- **데이터 복제:**  
  - 여러 노드에 데이터를 복제하여 하나의 노드가 장애 발생 시에도 데이터 손실 없이 서비스 제공.
- **자동 복구:**  
  - 장애 발생 시 자동으로 장애 노드를 교체하거나, 재시작하는 스크립트 및 오케스트레이션 도구(Kubernetes 등) 활용.

---

## 4. 실무 적용 및 고려 사항

- **설계 트레이드오프:**  
  - 강한 일관성을 유지할 것인지, 높은 가용성을 선택할 것인지에 대한 결정이 필요합니다.
- **운영 도구:**  
  - 장애 감지 및 대응을 위한 중앙 집중식 모니터링 시스템과 로그 분석 도구를 활용하여, 장애 발생 시 빠르게 대응할 수 있도록 합니다.
- **테스트 전략:**  
  - 장애 시나리오에 대한 시뮬레이션 테스트(Chaos Engineering)를 통해 시스템의 내구성을 지속적으로 검증합니다.
- **보안:**  
  - 장애 대응 과정에서도 보안 위협에 대한 대응(예: DoS 공격)과 데이터 무결성 보장을 고려해야 합니다.

---

## 5. 참고 자료

- [Chaos Engineering: Building Confidence in System Behavior](https://principlesofchaos.org/)  
- _Site Reliability Engineering_ - Google SRE 팀  
- [Byzantine Fault Tolerance Explained](https://www.infoq.com/articles/byzantine-fault-tolerance/)  
- [Distributed Systems: Principles and Paradigms](https://www.distributed-systems.net/) - Andrew S. Tanenbaum

---

## 6. 마무리

장애 모델 및 장애 대응 전략 문서는 분산 시스템 설계에서 발생할 수 있는 다양한 장애 상황을 미리 가정하고, 이에 대한 효과적인 대응 방안을 마련하는 데 중점을 둡니다.  
실제 시스템에서는 장애 감지, 페일오버, 재시도, 데이터 복제 등의 전략을 종합적으로 활용하여 서비스 중단 없이 안정적인 운영을 유지하는 것이 중요합니다.  
이 문서를 통해 다양한 장애 모델과 대응 전략을 이해하고, 실제 환경에 적용할 수 있는 인사이트를 얻길 바랍니다.