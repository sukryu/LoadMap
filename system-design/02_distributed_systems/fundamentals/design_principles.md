# 분산 시스템 설계 원칙

> **목표:**  
> - 분산 시스템 설계 시 반드시 고려해야 할 핵심 원칙들을 학습한다.  
> - CAP 이론, PACELC 이론, 데이터 샤딩 및 복제 전략, 일관성 모델 등 다양한 개념을 통해 설계 트레이드오프를 이해한다.  
> - 실무에서 요구되는 확장성, 가용성, 데이터 일관성 등을 균형 있게 달성할 수 있는 설계 방향을 제시한다.

---

## 1. 개념 개요

분산 시스템 설계는 여러 독립 노드 간에 데이터와 작업을 분산하여 처리하는 시스템을 구성하는 과정입니다.  
설계 시에는 다음과 같은 핵심 질문에 답해야 합니다:

- **어떤 요소를 희생할 것인가?**  
  - 확장성, 가용성, 일관성 중 어느 것을 최우선으로 할 것인가?
- **데이터를 어떻게 분산할 것인가?**  
  - 샤딩, 복제 등의 기법을 통해 데이터를 분산하고, 장애 시 복구 전략은 무엇인가?
- **노드 간 통신과 장애 대응은 어떻게 할 것인가?**  
  - 네트워크 지연, 파티션 발생 시 어떻게 대응할 것인가?

이러한 질문에 대한 답변을 기반으로 분산 시스템 설계 원칙이 도출됩니다.

---

## 2. 주요 설계 원칙

### 2.1 CAP 이론
- **정의:**  
  - **Consistency (일관성):** 모든 노드에서 같은 시점에 동일한 데이터를 볼 수 있음  
  - **Availability (가용성):** 각 요청에 대해 항상 응답을 제공함  
  - **Partition Tolerance (파티션 허용성):** 네트워크 파티션(통신 장애) 상황에서도 시스템이 동작함  
- **트레이드오프:**  
  - 분산 시스템은 네트워크 파티션 발생 가능성을 항상 고려해야 하므로, 일관성과 가용성 중 하나를 선택해야 하는 경우가 많습니다.
- **실무 적용:**  
  - 강한 일관성이 필요한 금융 시스템과, 가용성이 우선인 소셜 네트워크 등에서 각기 다른 선택을 할 수 있습니다.

### 2.2 PACELC 이론
- **정의:**  
  - **PACELC**는 CAP 이론을 확장한 개념으로, 파티션이 발생하지 않은 경우에도 **Latency (지연)**와 **Consistency (일관성)** 사이의 트레이드오프를 고려합니다.
- **실무 적용:**  
  - 네트워크 파티션 상황뿐 아니라 정상 상황에서도 데이터 동기화 지연과 일관성 보장 사이의 균형을 맞추는 설계가 필요합니다.

### 2.3 데이터 샤딩 (Sharding) 및 복제 (Replication)
- **샤딩:**  
  - 데이터를 여러 조각(샤드)으로 분할하여 각 노드에 분산 저장하는 방법입니다.
  - **장점:** 확장성 증대, 노드별 부하 감소  
  - **고려사항:** 샤드 키 선정, 재분배 및 재조정 전략 필요
- **복제:**  
  - 동일 데이터를 여러 노드에 복제하여 저장함으로써 가용성과 장애 복구 능력을 높입니다.
  - **장점:** 데이터 내구성 및 빠른 장애 복구  
  - **고려사항:** 복제본 간 일관성 유지 문제 (강한 일관성 vs 최종적 일관성)

### 2.4 데이터 일관성 모델
- **강한 일관성 (Strong Consistency):**  
  - 모든 읽기 요청이 항상 최신 데이터를 반영하도록 보장합니다.
  - **적용 사례:** 금융 거래, 실시간 데이터 업데이트
- **최종적 일관성 (Eventual Consistency):**  
  - 일정 시간이 지난 후 모든 복제본이 일관된 상태에 도달하는 모델입니다.
  - **적용 사례:** 소셜 네트워크, 캐싱 시스템

### 2.5 로드 밸런싱 및 페일오버
- **로드 밸런싱:**  
  - 클라이언트 요청을 여러 노드에 분산시켜 처리 부하를 고르게 분배합니다.
- **페일오버:**  
  - 특정 노드가 장애 발생 시 자동으로 다른 노드로 요청을 전환하여 시스템 가용성을 유지합니다.

---

## 3. 실무 적용 및 고려 사항

- **설계 트레이드오프 분석:**  
  - 각 원칙 사이의 균형(예: 강한 일관성과 낮은 지연 시간)을 어떻게 맞출 것인지 결정해야 합니다.
- **운영 및 모니터링:**  
  - 분산 시스템의 복잡성을 감안하여, 실시간 모니터링, 로깅, 자동화된 장애 대응 체계를 구축합니다.
- **보안:**  
  - 분산 환경에서의 데이터 전송과 저장 과정에서 암호화, 인증, 인가 등의 보안 전략을 반드시 포함해야 합니다.
- **테스트 전략:**  
  - 단위 테스트, 통합 테스트, 시뮬레이션 테스트를 통해 각 원칙의 구현이 올바르게 동작하는지 검증합니다.

---

## 4. 참고 자료

- **서적:**  
  - _Designing Data-Intensive Applications_ - Martin Kleppmann  
  - _Distributed Systems: Principles and Paradigms_ - Andrew S. Tanenbaum
- **온라인 자료:**  
  - [CAP Theorem Explained](https://www.scnsoft.com/blog/cap-theorem)  
  - [PACELC: Beyond CAP Theorem](https://www.infoq.com/articles/pacelc-explained/)

---

## 5. 마무리

분산 시스템 설계 원칙은 시스템이 확장 가능하고, 가용성이 높으며, 장애 발생 시에도 일관성을 유지하도록 하는 데 필수적인 가이드라인을 제공합니다.  
CAP 및 PACELC 이론을 비롯한 샤딩, 복제, 일관성 모델, 로드 밸런싱 등의 원칙을 적절히 적용하면, 복잡한 분산 환경에서도 안정적이고 효율적인 시스템을 설계할 수 있습니다.