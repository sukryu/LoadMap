# 저장소 일관성 모델

> **목표:**  
> - 분산 저장소 시스템에서 데이터 정합성을 유지하기 위한 일관성 모델의 개념과 필요성을 이해한다.  
> - 강한 일관성(Strong Consistency)과 최종적 일관성(Eventual Consistency) 등 주요 일관성 모델의 특징, 장단점, 그리고 CAP/PACELC 이론과의 관계를 학습한다.  
> - 실무 환경에서 저장소 일관성을 관리하고 최적화하기 위한 전략과 고려 사항을 도출한다.

---

## 1. 개념 개요

> **저장소 일관성 모델은 분산 저장소 시스템에서 여러 노드 간의 데이터 복제와 동기화를 어떻게 처리하여, 사용자에게 보이는 데이터의 정합성을 보장할 것인지를 정의하는 기준이다.**

- **정의:**  
  - 저장소 일관성 모델은 분산 환경에서 데이터 복제본 간의 일관된 상태 유지와 업데이트 전파 방식, 그리고 클라이언트가 읽을 때 최신 데이터 또는 최종적 일관성을 보장받을 수 있는 정책을 의미합니다.
  
- **왜 중요한가?**  
  - **데이터 정합성 유지:**  
    - 분산 저장소에서는 데이터가 여러 노드에 분산되어 저장되기 때문에, 각 노드 간의 데이터 상태가 일관되지 않으면 사용자와 애플리케이션의 신뢰성이 저하됩니다.
  - **서비스 신뢰성 및 장애 복구:**  
    - 장애나 네트워크 파티션 상황에서도 일관성 모델에 따라 데이터가 복구되거나 최종적으로 수렴할 수 있도록 보장해야 합니다.
  - **성능과 확장성의 균형:**  
    - 강한 일관성을 유지하면 응답 지연이 발생할 수 있고, 최종적 일관성을 선택하면 일시적 불일치가 발생할 수 있으므로, 애플리케이션의 요구사항에 맞는 균형을 찾아야 합니다.

- **어떤 문제를 해결하는가?**  
  - **데이터 불일치 및 동시성 문제:**  
    - 여러 노드에 걸쳐 데이터가 복제될 때, 즉각적인 동기화가 어려워 발생할 수 있는 불일치 문제를 해결합니다.
  - **네트워크 지연 및 장애에 따른 일관성 유지:**  
    - 네트워크 파티션이나 지연 상황에서도 데이터의 수렴 및 정합성을 보장하는 정책을 마련합니다.

---

## 2. 주요 일관성 모델

### 2.1 강한 일관성 (Strong Consistency)
- **개념:**  
  - 모든 클라이언트가 어떤 시점에 읽어도 항상 최신의 동일한 데이터를 반환받도록 보장하는 모델입니다.
- **특징:**  
  - 업데이트가 완료되면, 모든 노드가 즉시 동일한 상태를 반영합니다.
  - 주로 트랜잭션 처리, 금융 거래, 주문 처리 등 높은 데이터 정합성이 요구되는 애플리케이션에서 사용됩니다.
- **장점 및 단점:**  
  - **장점:**  
    - 데이터 정합성이 매우 높고 예측 가능한 동작을 보장합니다.
  - **단점:**  
    - 동기화 과정으로 인해 응답 지연(latency)이 증가하며, 확장성이 제한될 수 있습니다.

### 2.2 최종적 일관성 (Eventual Consistency)
- **개념:**  
  - 데이터 업데이트가 모든 노드에 즉시 반영되지는 않지만, 일정 시간이 지나면 모든 복제본이 결국 동일한 상태에 도달하도록 하는 모델입니다.
- **특징:**  
  - 높은 가용성과 성능을 위해 비동기 복제를 사용하며, 일시적인 데이터 불일치가 허용됩니다.
  - 주로 캐시, 소셜 미디어, 비즈니스 로그 분석 등 데이터의 최신성이 절대적으로 필수적이지 않은 시스템에서 사용됩니다.
- **장점 및 단점:**  
  - **장점:**  
    - 빠른 응답 시간과 높은 확장성을 제공하며, 장애 발생 시에도 시스템이 계속 운영될 수 있습니다.
  - **단점:**  
    - 일시적 불일치 현상이 발생할 수 있으며, 데이터 일관성이 완전히 보장되기까지 시간이 소요됩니다.

### 2.3 CAP/PACELC 이론과의 연관성
- **CAP 이론:**  
  - 분산 시스템에서 동시에 Consistency, Availability, Partition Tolerance를 모두 만족시키기 어렵다는 점을 설명하며, 일관성 모델 선택 시 CP(Consistency + Partition Tolerance)와 AP(Availability + Partition Tolerance) 중 하나를 선택하게 합니다.
- **PACELC 이론:**  
  - 네트워크 파티션 발생 상황뿐만 아니라 정상 상황에서도 Latency와 Consistency 사이의 트레이드오프를 고려하는 모델로, 저장소 일관성 모델을 선택할 때 추가적인 고려사항을 제공합니다.

---

## 3. 실무 적용 및 고려 사항

- **애플리케이션 요구사항 분석:**  
  - 데이터 정합성이 절대적으로 중요한 서비스는 강한 일관성을, 빠른 응답성과 확장성이 중요한 서비스는 최종적 일관성을 선택합니다.
  
- **네트워크 환경 및 장애 대비:**  
  - 네트워크 지연, 파티션 발생 시 데이터 복제 및 동기화 전략을 마련하여, 어떤 일관성 모델을 선택하더라도 최종적으로 데이터가 일관되게 유지될 수 있도록 설계해야 합니다.
  
- **트레이드오프 고려:**  
  - 강한 일관성은 데이터 정확성을 보장하지만 응답 속도와 확장성에 제약을 주고, 최종적 일관성은 높은 성능과 확장성을 제공하지만 일시적인 불일치 문제가 있을 수 있으므로, 서비스의 특성에 따라 적절한 모델을 선택해야 합니다.
  
- **모니터링 및 최적화:**  
  - 일관성 모델이 적용된 시스템의 성능, 응답 시간, 데이터 동기화 상태 등을 모니터링하고, 필요에 따라 스냅샷, 이벤트 로그 정리 등의 최적화 전략을 적용합니다.

---

## 4. 추천 리소스

- 📖 _Designing Data-Intensive Applications_ - Martin Kleppmann  
- 📖 _Distributed Systems: Principles and Paradigms_ - Andrew S. Tanenbaum  
- 온라인 자료: [CAP Theorem Explained](https://www.scnsoft.com/blog/cap-theorem), [PACELC Theorem Overview](https://dbmsmusings.blogspot.com/2010/04/problems-with-cap-and-yahoos-little.html)

---

## 5. 마무리

저장소 일관성 모델은 분산 저장소 시스템에서 데이터 정합성을 유지하기 위한 핵심 요소로, 강한 일관성과 최종적 일관성 사이의 선택은 애플리케이션의 요구사항과 운영 환경에 따라 결정되어야 합니다.  
CAP 및 PACELC 이론을 통해 일관성과 가용성, 응답 시간 간의 트레이드오프를 면밀히 분석하고, 모니터링 및 최적화 전략을 함께 수립하는 것이 중요합니다.  
이 문서를 통해 저장소 일관성 모델의 기본 원리와 실무 적용 전략을 명확히 이해하여, 안정적이고 효율적인 분산 저장소 시스템 설계에 참고하시길 바랍니다.