# 강한 일관성 (Strong Consistency)

> **목표:**  
> - 분산 시스템에서 강한 일관성의 개념과 필요성을 이해한다.  
> - 모든 노드가 동일한 데이터를 동시에 제공하여 데이터 정합성을 보장하는 방법을 학습한다.  
> - 강한 일관성을 유지하기 위한 설계 방법과 그에 따른 트레이드오프(성능, 지연 등)를 분석한다.

---

## 1. 개념 개요

> **강한 일관성은 모든 읽기 작업이 항상 최신의, 동일한 데이터를 반환하도록 보장하는 일관성 모델이다.**

- **정의:**  
  - 강한 일관성 모델에서는 클라이언트가 어떤 노드에 접근하더라도, 항상 동일한 최신 데이터를 읽을 수 있도록 합니다.  
  - 즉, 업데이트가 완료된 후에는 모든 후속 읽기 작업에서 업데이트된 데이터가 반영됩니다.

- **왜 중요한가?**  
  - **데이터 정합성 보장:** 금융 거래, 재고 관리, 결제 시스템 등에서 최신 데이터가 반드시 필요할 때 강한 일관성은 필수적입니다.  
  - **예측 가능한 동작:** 모든 노드가 동일한 데이터를 제공함으로써, 애플리케이션의 동작이 예측 가능해지고 오류 발생 가능성이 줄어듭니다.

- **어떤 문제를 해결하는가?**  
  - **데이터 불일치:** 업데이트가 노드마다 다르게 반영되는 문제를 제거합니다.  
  - **동시성 제어:** 여러 사용자가 동시에 데이터에 접근하는 상황에서도, 항상 일관된 상태를 보장합니다.

- **실무 적용:**  
  - Google Spanner, ZooKeeper 등에서는 강한 일관성을 통해 분산 환경에서의 데이터 정합성을 확보하고 있습니다.  
  - 금융 거래, 주문 처리와 같이 데이터의 최신성이 필수적인 서비스에서 주로 사용됩니다.

---

## 2. 강한 일관성의 동작 원리

- **업데이트 전파:**  
  - 강한 일관성을 위해, 데이터 업데이트는 모든 관련 노드에 동기적으로 전파되어야 합니다.  
  - 업데이트 완료 전까지 읽기 요청은 이전의 데이터 혹은 업데이트 중인 데이터를 반환하지 않도록 합니다.

- **동기화 메커니즘:**  
  - 분산 시스템에서는 분산 트랜잭션, 동기 복제, 그리고 원자적 커밋(atomic commit) 등의 기법을 통해 각 노드가 동일한 데이터를 유지하도록 동기화합니다.
  - 예를 들어, Two-Phase Commit(2PC) 프로토콜은 모든 참여 노드가 업데이트를 승인한 후에만 커밋을 진행하여, 강한 일관성을 보장합니다.

- **리더 기반 접근:**  
  - 강한 일관성을 유지하기 위해 리더 기반 시스템(예: Raft, ZAB)을 활용하여 모든 변경 작업이 단일 리더를 통해 이루어지도록 하고, 후속 노드에 변경사항을 전파합니다.

---

## 3. 장단점 및 트레이드오프

### 장점
- **데이터 정합성:**  
  - 모든 클라이언트가 동일한 최신 데이터를 읽으므로, 데이터 불일치로 인한 문제를 원천 차단할 수 있습니다.
- **예측 가능성:**  
  - 시스템의 상태가 항상 일관되게 유지되어, 애플리케이션 동작 및 사용자 경험이 안정적입니다.
- **신뢰성:**  
  - 중요한 업무 처리(예: 금융 거래, 주문 처리)에서 데이터의 정확성과 신뢰성을 보장합니다.

### 단점
- **응답 지연:**  
  - 동기화 및 업데이트 전파 과정 때문에 네트워크 지연이 발생할 수 있으며, 시스템 응답 시간이 길어질 수 있습니다.
- **확장성 제한:**  
  - 모든 노드가 업데이트를 즉시 반영해야 하므로, 노드 수가 많아질수록 성능 저하나 병목 현상이 발생할 가능성이 있습니다.
- **복잡한 구현:**  
  - 분산 환경에서 강한 일관성을 유지하기 위한 동기화 메커니즘은 구현 및 관리가 복잡할 수 있습니다.

---

## 4. 실무 적용 사례

- **Google Spanner:**  
  - 글로벌 데이터베이스 서비스로, 강한 일관성을 유지하기 위해 동기 복제와 외부 전역 시계를 활용하여 데이터 정합성을 보장합니다.
  
- **ZooKeeper:**  
  - 분산 시스템의 코디네이션 서비스를 제공하며, 강한 일관성 모델을 통해 분산 락, 구성 관리 등에서 신뢰할 수 있는 데이터 상태를 유지합니다.
  
- **금융 및 주문 처리 시스템:**  
  - 금융 거래 시스템이나 전자상거래 플랫폼에서는 실시간 데이터 업데이트와 정확한 주문 처리를 위해 강한 일관성 모델을 적용합니다.

---

## 5. 실무 적용 및 고려 사항

- **네트워크 환경:**  
  - 강한 일관성을 유지하려면 안정적인 네트워크 환경이 필수적입니다. 네트워크 지연이나 장애가 발생하면 전체 시스템의 응답 속도에 큰 영향을 미칠 수 있습니다.
  
- **성능과 확장성:**  
  - 강한 일관성을 유지하는 시스템은 응답 시간이 길어질 수 있으므로, 확장성과 성능을 보완하기 위한 캐싱, 읽기 전용 복제 등의 보조 전략을 함께 고려해야 합니다.
  
- **트레이드오프 결정:**  
  - 애플리케이션의 요구사항에 따라 강한 일관성이 반드시 필요한지, 아니면 최종적 일관성과 같은 약한 일관성 모델로도 충분한지 신중하게 판단해야 합니다.

---

## 6. 참고 자료

- 📖 _Designing Data-Intensive Applications_ - Martin Kleppmann  
- 📖 _Distributed Systems: Principles and Paradigms_ - Andrew S. Tanenbaum  
- 온라인 자료: [Google Spanner White Paper](https://research.google/pubs/pub39966/), [ZooKeeper Documentation](https://zookeeper.apache.org/)

---

## 7. 마무리

강한 일관성은 분산 시스템에서 데이터 정합성과 신뢰성을 극대화하기 위한 중요한 모델입니다.  
모든 노드가 동일한 최신 데이터를 제공함으로써, 금융 거래나 주문 처리와 같이 정확한 데이터가 필수적인 서비스에서 효과적으로 활용됩니다.  
그러나 응답 지연, 확장성의 한계 등 트레이드오프를 신중히 고려해야 하며, 실제 시스템 설계에서는 서비스의 요구사항에 따라 적절한 일관성 모델을 선택하는 것이 중요합니다.