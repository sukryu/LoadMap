# Raft 알고리즘

> **목표:**  
> - Raft 알고리즘의 기본 개념과 동작 원리를 이해한다.  
> - 리더 선출, 로그 복제, 안전성 보장을 위한 Raft의 주요 구성 요소와 프로세스를 학습한다.  
> - Paxos와 비교하여 Raft의 이해도 및 구현 용이성을 평가하고, 실무 적용 시의 장단점을 분석한다.

---

## 1. 개념 개요

Raft 알고리즘은 분산 시스템에서 노드들이 일관된 상태를 유지하도록 돕는 리더 기반 합의 알고리즘입니다. Paxos의 복잡성을 보완하기 위해 고안된 Raft는 이해하기 쉽고, 구현 및 디버깅이 용이한 점에서 널리 사용됩니다.

- **왜 중요한가?**  
  - **이해와 구현 용이성:** Paxos보다 직관적인 설계로 개발자들이 합의 알고리즘을 보다 쉽게 이해하고 적용할 수 있습니다.  
  - **데이터 일관성 유지:** 분산 로그 복제 및 상태 머신 복제를 통해 각 노드 간 데이터 일관성을 보장합니다.  
  - **실무 적용:** 분산 데이터베이스, 로그 시스템, 클러스터 관리 시스템 등에서 리더 선출과 로그 복제에 활용됩니다.

- **어떤 문제를 해결하는가?**  
  - **리더 선출:** 시스템 내 단일 리더를 선택하여 모든 변경 작업을 중앙 집중식으로 처리, 충돌을 방지합니다.  
  - **로그 복제:** 리더의 로그를 팔로워들에게 복제하여 모든 노드가 동일한 상태로 유지되도록 합니다.  
  - **안전성:** 시스템 장애나 네트워크 파티션 상황에서도 올바른 결정을 내리고, 일관성을 유지합니다.

---

## 2. Raft의 구성 요소

Raft 알고리즘은 크게 세 가지 역할로 구성됩니다:

### 2.1 리더 (Leader)
- **역할:**  
  - 클러스터 내에서 모든 로그 복제 작업과 클라이언트 요청 처리를 담당합니다.
  - 정기적인 하트비트(heartbeat)를 팔로워들에게 전송하여 자신의 존재를 알리고, 클러스터의 상태를 유지합니다.

### 2.2 팔로워 (Follower)
- **역할:**  
  - 리더로부터 로그 복제 명령과 하트비트를 수신합니다.
  - 리더로부터 응답이 없거나, 타임아웃이 발생하면 후보(Candidate)로 전환할 수 있습니다.

### 2.3 후보 (Candidate)
- **역할:**  
  - 리더로부터의 하트비트를 받지 못했을 때, 새로운 리더 선출을 위해 후보 상태로 전환됩니다.
  - 클러스터 내 다른 노드로부터 투표를 받아 과반수 이상의 지지를 얻으면 리더로 승격됩니다.

---

## 3. Raft의 동작 과정

Raft 알고리즘은 다음의 주요 단계로 구성됩니다:

### 3.1 리더 선출 (Leader Election)
- **프로세스:**  
  - 각 팔로워는 하트비트 메시지를 일정 시간 동안 받지 못하면 후보로 전환되고, 새로운 리더를 선출하기 위한 투표를 시작합니다.
  - 각 후보는 자신에게 투표하도록 요청하며, 과반수 이상의 지지를 받으면 리더로 승격됩니다.
- **특징:**  
  - 리더 선출 과정은 짧은 시간 내에 이루어져야 하며, 클러스터 전체의 상태 안정화를 신속하게 도모합니다.

### 3.2 로그 복제 (Log Replication)
- **프로세스:**  
  - 클라이언트의 명령은 리더에 의해 로그 항목으로 기록되고, 해당 로그 항목이 팔로워에게 전파됩니다.
  - 팔로워는 받은 로그 항목을 자신의 로그에 추가한 후, 리더에게 응답합니다.
  - 리더는 과반수의 노드가 동일한 로그 항목을 보유하면, 해당 항목을 커밋(commit)하여 상태 머신에 적용합니다.
- **특징:**  
  - 로그 복제는 모든 노드가 일관된 상태를 유지하도록 보장하며, 장애 발생 시에도 리더의 로그를 기준으로 복구할 수 있습니다.

### 3.3 안전성 및 일관성 보장 (Safety and Consistency)
- **리더 전환 시 일관성:**  
  - 새로운 리더는 자신이 가지고 있는 최신 로그를 기반으로 클러스터를 재동기화합니다.
- **로그 일관성:**  
  - 각 노드의 로그는 항상 리더의 로그와 일치해야 하며, 분기(fork)가 발생하면 오래된 로그를 폐기하고 최신 로그를 복제합니다.

---

## 4. Raft의 장단점 및 실무 적용 고려 사항

### 4.1 장점
- **이해도와 구현 용이성:**  
  - Paxos에 비해 구조가 명확하고 단계별 프로세스가 단순하여 학습과 구현이 쉽습니다.
- **리더 기반 설계:**  
  - 중앙 집중식 리더를 통해 클러스터 관리와 로그 복제 과정이 간결해집니다.
- **안정성과 신속한 복구:**  
  - 장애 발생 시 빠른 리더 선출과 로그 복제를 통해 시스템의 안정성을 유지할 수 있습니다.

### 4.2 단점
- **리더 부하 집중:**  
  - 모든 클라이언트 요청과 로그 복제 작업이 리더에 집중되어, 리더에 부하가 집중될 수 있습니다.
- **리더 장애 시 선출 지연:**  
  - 리더 장애 시 새로운 리더 선출 과정이 지연되면 일시적인 서비스 중단이 발생할 수 있습니다.
- **네트워크 환경 의존성:**  
  - 하트비트 및 로그 복제의 빈번한 통신이 네트워크 상태에 크게 의존하므로, 네트워크 지연이나 불안정성이 전체 성능에 영향을 미칠 수 있습니다.

### 4.3 실무 적용 고려 사항
- **모니터링과 자동화:**  
  - 리더 선출, 로그 복제, 하트비트 모니터링 등을 위한 자동화 도구 및 모니터링 시스템 구축이 필요합니다.
- **부하 분산:**  
  - 리더에 과도한 부하가 걸리지 않도록 클러스터 설계 시 부하 분산 전략을 고려해야 합니다.
- **장애 시나리오 테스트:**  
  - 실제 장애 상황을 가정한 시뮬레이션(예: Chaos Engineering)을 통해 시스템의 내구성과 복구 시간을 검증해야 합니다.

---

## 5. 참고 자료

- **서적:**  
  - _Raft: In Search of an Understandable Consensus Algorithm_ - Diego Ongaro, John Ousterhout  
  - _Designing Data-Intensive Applications_ - Martin Kleppmann  
- **온라인 자료:**  
  - [The Raft Consensus Algorithm](https://raft.github.io/)  
  - [Understanding Raft](https://thesecretlivesofdata.com/raft/)

---

## 6. 마무리

Raft 알고리즘은 분산 시스템 내에서 이해하기 쉽고 구현이 용이한 합의 알고리즘으로, 리더 선출과 로그 복제 과정을 통해 각 노드 간 일관성을 유지합니다.  
실무에서는 리더 기반 구조를 활용하여 클러스터 관리를 단순화하고, 장애 발생 시 신속한 복구를 도모할 수 있습니다.  
이 문서를 통해 Raft의 주요 개념과 동작 과정을 학습하고, Paxos와의 차이점을 이해하여 분산 시스템 설계 시 적절한 합의 알고리즘을 선택하는 데 도움을 받을 수 있기를 바랍니다.