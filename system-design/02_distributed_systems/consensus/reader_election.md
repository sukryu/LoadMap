# 리더 선출 기법

> **목표:**  
> - 분산 시스템에서 리더 선출의 필요성과 원리를 이해한다.  
> - ZooKeeper의 ZAB, Kafka의 리더 선출 방식 등 다양한 리더 선출 기법을 학습한다.  
> - 리더 선출 과정에서 발생할 수 있는 장애 및 트레이드오프를 분석하고, 실무 적용 방안을 모색한다.

---

## 1. 개념 개요

분산 시스템에서는 여러 노드가 동시에 존재하며, 이들 간에 일관된 결정을 내리기 위해 단일 리더를 선출하는 과정이 필요합니다.

- **왜 중요한가?**  
  - **중앙 집중적 제어:** 리더가 모든 클라이언트 요청과 로그 복제, 상태 변경 등의 작업을 조율하여, 시스템 전반의 일관성을 유지합니다.  
  - **충돌 방지:** 여러 노드가 동시에 변경 작업을 수행하는 것을 방지하고, 충돌이나 데이터 불일치를 줄입니다.  
  - **장애 대응:** 리더 장애 시 빠르게 새로운 리더를 선출함으로써, 시스템의 가용성을 유지할 수 있습니다.

- **어떤 문제를 해결하는가?**  
  - **다중 동시성 문제:** 분산 환경에서 여러 노드가 동시에 작업하면 발생할 수 있는 충돌 문제를 예방합니다.  
  - **일관성 유지:** 리더를 통한 중앙 집중식 관리로 모든 노드에 동일한 결정을 전파하여 일관된 상태를 보장합니다.
  - **신속한 복구:** 리더 장애 시 자동으로 새로운 리더를 선출하여, 시스템 복구 시간을 최소화합니다.

---

## 2. 주요 리더 선출 기법

### 2.1 ZAB (ZooKeeper Atomic Broadcast)
- **개념:**  
  - Apache ZooKeeper에서 사용하는 프로토콜로, 리더 선출 및 상태 동기화를 위한 기법입니다.
- **특징:**  
  - **원자적 방송:** 리더가 모든 변경 사항을 원자적으로 브로드캐스트 하여, 각 팔로워들이 일관된 상태를 유지하도록 합니다.  
  - **신속한 장애 감지:** 팔로워들이 정기적으로 리더의 하트비트를 감시하여, 장애 발생 시 빠른 리더 선출이 가능합니다.
- **실무 적용:**  
  - ZooKeeper를 사용하는 분산 애플리케이션에서 리더 선출 및 클러스터 관리를 담당.

### 2.2 Raft 기반 리더 선출
- **개념:**  
  - Raft 알고리즘 내에서 리더 선출은 팔로워들이 하트비트를 받지 못할 경우 후보로 전환되어, 투표를 통해 새로운 리더를 결정하는 방식입니다.
- **특징:**  
  - **투표 메커니즘:** 후보가 과반수 이상의 투표를 받으면 리더로 선출됩니다.
  - **간결성:** Raft는 리더 선출 과정을 명확한 상태 전이로 관리하여, 구현과 디버깅이 용이합니다.
- **실무 적용:**  
  - 분산 로그 복제 및 상태 머신 복제를 사용하는 시스템에서, 안정적인 리더 선출을 보장하는 데 활용됩니다.

### 2.3 기타 기법 (예: Bully Algorithm, Ring Algorithm)
- **Bully Algorithm:**  
  - **개념:** 모든 노드에 고유한 우선순위(혹은 ID)를 부여하고, 우선순위가 높은 노드가 리더로 선출되는 방식입니다.
  - **특징:**  
    - 간단한 구현으로, 고장난 노드를 빠르게 감지하고 리더를 교체할 수 있습니다.
    - 단점으로는 우선순위가 높은 노드에 장애가 발생할 경우 전체 시스템의 재선출 과정이 복잡해질 수 있습니다.
- **Ring Algorithm:**  
  - **개념:** 노드들이 논리적인 원형 구조를 형성하고, 일정한 순서대로 메시지를 전달하며 리더를 선출합니다.
  - **특징:**  
    - 네트워크 구조에 따라 효율적일 수 있으나, 노드 수가 많아지면 선출 과정의 지연이 발생할 수 있습니다.

---

## 3. 실무 적용 및 고려 사항

- **장애 복구와 신속성:**  
  - 리더 장애 발생 시 빠른 감지와 자동 리더 선출이 필수적입니다. 이를 위해 하트비트 및 타임아웃 설정을 최적화해야 합니다.
- **네트워크 환경:**  
  - 네트워크 지연이나 분할(Partition) 상황을 고려하여, 안정적인 리더 선출 프로토콜을 선택해야 합니다.
- **부하 분산:**  
  - 리더에 부하가 집중되지 않도록, 리더 선출 기법과 함께 전체 클러스터의 부하 분산 전략도 마련해야 합니다.
- **모니터링과 테스트:**  
  - 리더 선출 과정과 관련된 로그, 하트비트, 투표 결과 등을 모니터링하고, 시뮬레이션 테스트(예: Chaos Engineering)를 통해 시스템 내 장애 복구 능력을 주기적으로 점검해야 합니다.

---

## 4. 참고 자료

- [ZooKeeper: The Art of Distributed Coordination](https://zookeeper.apache.org/)  
- _Designing Data-Intensive Applications_ - Martin Kleppmann  
- [Understanding Raft](https://thesecretlivesofdata.com/raft/)  
- _Distributed Systems: Principles and Paradigms_ - Andrew S. Tanenbaum

---

## 5. 마무리

리더 선출 기법은 분산 시스템에서 일관된 상태 유지와 장애 복구를 위해 필수적인 요소입니다.  
ZooKeeper의 ZAB, Raft 기반의 리더 선출, 그리고 Bully나 Ring 알고리즘과 같은 다양한 기법을 통해, 시스템의 신뢰성과 가용성을 높일 수 있습니다.  
실무에서는 각 기법의 장단점을 고려하여, 요구사항에 맞는 최적의 리더 선출 전략을 선택하고, 지속적인 모니터링과 테스트를 통해 안정적인 시스템 운영을 유지하는 것이 중요합니다.