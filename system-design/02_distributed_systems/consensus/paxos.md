# Paxos 알고리즘

> **목표:**  
> - Paxos 알고리즘의 기본 개념과 동작 원리를 이해한다.  
> - 분산 시스템에서 신뢰할 수 있는 합의를 달성하기 위한 역할(프로포저, 어셉터, 러너)을 학습한다.  
> - Simple Paxos와 Multi-Paxos 등 다양한 변형과 실제 응용 사례를 분석한다.

---

## 1. 개념 개요

Paxos 알고리즘은 분산 환경에서 여러 노드가 하나의 일관된 결정을 내리도록 보장하는 합의 프로토콜입니다.  
알고리즘은 네트워크 지연, 메시지 손실, 노드 장애 등 다양한 장애 상황에서도 시스템이 올바른 결정을 내릴 수 있도록 설계되었습니다.

- **왜 중요한가?**  
  - **데이터 일관성 유지:** 분산 데이터베이스, 트랜잭션 처리, 리더 선출 등 다양한 상황에서 노드 간 데이터 일관성을 보장합니다.  
  - **장애 내성:** 네트워크 문제나 노드 장애 상황에서도 시스템이 안정적으로 작동할 수 있게 합니다.  
  - **실무 적용:** Google Spanner, Chubby, ZooKeeper 등 여러 시스템에서 합의를 위한 기반 프로토콜로 활용됩니다.

- **어떤 문제를 해결하는가?**  
  - 네트워크 단절, 메시지 지연, 노드 장애 등으로 인한 데이터 불일치 및 충돌 문제  
  - 분산 환경에서 신뢰할 수 있는 단일 결정(합의)을 내리기 위한 문제 해결  
  - 여러 노드 간의 협력 하에 안정적인 상태 전이를 구현

---

## 2. Paxos의 구성 요소와 동작 원리

Paxos 알고리즘은 기본적으로 세 가지 역할로 구성됩니다:

### 2.1 역할 (Roles)
- **프로포저 (Proposer):**  
  - 합의를 제안하는 역할을 하며, 제안 번호와 함께 값을 제시합니다.  
  - 여러 프로포저가 있을 수 있으며, 경쟁 상황에서 가장 높은 제안 번호를 가진 값이 채택될 가능성이 높습니다.

- **어셉터 (Acceptor):**  
  - 프로포저의 제안을 받아들이거나 거부하는 역할을 합니다.  
  - 다수의 어셉터 중 과반수 이상의 동의를 얻어야 합의가 이루어집니다.
  
- **러너 (Learner):**  
  - 최종적으로 채택된 값을 학습하는 역할을 하며, 시스템 전반에 해당 결정이 전파됩니다.

### 2.2 동작 단계

Paxos 알고리즘은 일반적으로 다음의 세 단계로 동작합니다:

1. **Prepare 단계:**  
   - 프로포저가 새로운 제안 번호를 생성하여 어셉터들에게 `Prepare` 메시지를 전송합니다.
   - 어셉터는 자신이 이미 약속한(혹은 채택한) 제안 번호보다 낮은 번호의 제안을 받으면, 해당 프로포저의 제안을 고려하겠다고 응답합니다.

2. **Promise 단계:**  
   - 어셉터는 자신이 이전에 채택한 값이 있다면 그 값을 함께 응답하고, 해당 제안 번호보다 낮은 번호의 다른 제안을 거부하겠다는 `Promise` 메시지를 보냅니다.
   - 프로포저는 과반수 이상의 어셉터로부터 약속을 받으면, 그 중 가장 높은 제안 번호에 해당하는 값을 선택하여 최종 제안을 준비합니다.

3. **Accept 단계:**  
   - 프로포저는 선택된 값을 포함한 `Accept` 요청을 어셉터들에게 전송합니다.
   - 어셉터는 여전히 약속한 조건 내에서 해당 값을 수락하게 되고, 과반수 이상의 어셉터가 이를 수락하면 그 값이 최종적으로 채택됩니다.
   - 이후 러너는 채택된 값을 학습하게 되어 전체 시스템에 결정이 반영됩니다.

---

## 3. Paxos의 변형 및 확장

### 3.1 Simple Paxos vs. Multi-Paxos
- **Simple Paxos:**  
  - 한 번의 합의를 위한 기본 형태로, 단일 값을 결정하기 위해 각 단계가 반복됩니다.
  - 이해와 구현은 상대적으로 간단하지만, 매번 새로운 합의를 위해 전체 프로세스를 반복해야 합니다.

- **Multi-Paxos:**  
  - 연속적인 합의를 위해 한 번의 리더 선출 후 여러 값에 대해 합의를 진행하는 방식입니다.
  - 리더가 선정되면, 준비 단계(Prepare 단계)를 한 번만 수행하고, 이후 연속된 Accept 단계만 수행하여 효율성을 크게 향상시킵니다.
  - 대규모 분산 시스템에서 지속적인 상태 변화(로그 복제 등)를 관리하는 데 효과적입니다.

---

## 4. 실무 적용 및 고려 사항

- **장애 대응:**  
  - Paxos는 노드 간 네트워크 지연이나 일부 노드의 실패 상황에서도 합의를 이끌어내는 강점을 가지고 있습니다.
  - 다만, 메시지 손실이나 여러 프로포저 간의 경쟁 상황에서 복잡성이 증가할 수 있으므로, Multi-Paxos와 같은 확장 기법을 통해 최적화가 필요합니다.

- **성능 트레이드오프:**  
  - 단순한 Paxos는 매번 준비 단계를 거치므로 성능 오버헤드가 발생할 수 있습니다.  
  - Multi-Paxos는 리더 선출 후 연속된 합의 처리가 가능하므로, 트랜잭션이나 로그 복제와 같은 연속적 작업에서 유리합니다.

- **실제 시스템 적용:**  
  - Google Spanner, Chubby, ZooKeeper 등과 같이 분산 시스템의 핵심 인프라에서 Paxos 또는 그 변형을 활용하여 높은 신뢰성과 데이터 일관성을 유지하고 있습니다.

---

## 5. 참고 자료

- **서적:**  
  - _Designing Data-Intensive Applications_ - Martin Kleppmann  
  - _Distributed Systems: Principles and Paradigms_ - Andrew S. Tanenbaum  
- **온라인 자료:**  
  - [Paxos Made Simple](http://www.cs.cmu.edu/~glens/paxos-simple.pdf) - Leslie Lamport  
  - [Paxos Explained](https://www.freecodecamp.org/news/paxos-algorithm-in-plain-english/)  

---

## 6. 마무리

Paxos 알고리즘은 분산 시스템에서 노드들이 장애 상황에서도 신뢰할 수 있는 합의를 이루기 위한 강력한 도구입니다.  
프로포저, 어셉터, 러너와 같은 역할 간의 상호작용을 통해 데이터 일관성을 유지하고, 다양한 변형(예: Multi-Paxos)을 통해 성능 및 확장성을 개선할 수 있습니다.  
실무에서는 Paxos의 원리를 이해하고, 요구 사항에 따라 적절한 변형을 선택하여 시스템에 적용하는 것이 중요합니다.