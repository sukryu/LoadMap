# 큐 자료구조 - 실무 의사결정 프레임워크

## 1. 문제 상황 분석 체크리스트

### 큐를 고려해야 하는 신호들

다음 중 2개 이상 해당하면 큐 사용을 검토하세요:

- [ ] **순서가 중요한가?** (먼저 온 요청을 먼저 처리해야 함)
- [ ] **비동기 처리가 필요한가?** (요청 받는 속도 ≠ 처리 속도)
- [ ] **버퍼링이 필요한가?** (일시적인 과부하 상황 대응)
- [ ] **생산자와 소비자가 분리되어 있는가?** (요청하는 쪽 ≠ 처리하는 쪽)
- [ ] **처리량 조절이 필요한가?** (초당 처리 개수 제한)

## 2. 실무 시나리오별 의사결정 트리

### 시나리오 1: 메시징 시스템 (카카오톡)

**상황**: 사용자들이 메시지를 주고받는 시스템

**분석 과정:**

```
1. 순서가 중요한가? → YES (메시지 순서 보장 필요)
2. 비동기 처리가 필요한가? → YES (전송 ≠ 수신)
3. 버퍼링이 필요한가? → YES (상대방이 오프라인일 수 있음)

결론: 큐 적합
```

**구체적 설계:**

- **메시지 송신 큐**: 발송 대기 중인 메시지들
- **사용자별 수신 큐**: 오프라인 중 받은 메시지들
- **알림 큐**: 푸시 알림 발송 대기열

**예상 문제점과 대응:**

- 큐가 계속 커진다면? → 오래된 메시지 자동 삭제 정책
- 메모리 부족? → Redis 같은 외부 큐 서비스 활용
- 메시지 순서가 바뀐다면? → 타임스탬프 + 시퀀스 번호 병용

### 시나리오 2: 전자상거래 주문 처리 (쿠팡)

**상황**: 초당 1만건의 주문이 몰리는 상황

**분석 과정:**

```
1. 순서가 중요한가? → PARTIALLY (선착순 이벤트는 중요, 일반 주문은 아님)
2. 비동기 처리가 필요한가? → YES (주문 접수 ≠ 결제 처리)
3. 처리량 조절이 필요한가? → YES (결제 시스템 과부하 방지)

결론: 우선순위 큐 + 일반 큐 조합
```

**구체적 설계:**

- **일반 주문 큐**: FIFO로 순차 처리
- **VIP 주문 우선순위 큐**: 등급별 차등 처리
- **결제 처리 큐**: 외부 PG사 API 호출 제한
- **재고 확인 큐**: 데이터베이스 부하 분산

### 시나리오 3: 유튜브 댓글 시스템

**상황**: 인기 영상에 댓글이 실시간으로 쏟아짐

**분석 과정:**

```
1. 순서가 중요한가? → YES (최신 댓글이 위에 표시)
2. 대댓글 구조가 필요한가? → YES (트리 구조)
3. 실시간 업데이트가 필요한가? → YES

결론: 큐 + 트리 구조 조합
```

**왜 단순 큐로는 부족한가?**

- 대댓글은 부모-자식 관계 → 트리 구조 필요
- 댓글 신고/삭제 → 중간 삭제 기능 필요
- 실시간 업데이트 → WebSocket + 이벤트 큐 조합

## 3. 큐를 선택하지 말아야 하는 상황들

### 안티패턴 1: 무작정 큐 남용

**잘못된 사례**: “모든 비동기 처리에 큐를 써야지!”

```python
# 잘못된 예시
def simple_calculation(a, b):
    task_queue.put(lambda: a + b)  # 불필요한 큐 사용
    return task_queue.get()
```

**올바른 접근**: 간단한 동기 처리는 직접 실행

### 안티패턴 2: 우선순위가 있는데 일반 큐 사용

**문제 상황**: 병원 응급실 대기시스템

- 일반 큐 사용 → 심장마비 환자가 감기 환자 뒤에서 대기
- 해결: 우선순위 큐 또는 별도 큐 분리

### 안티패턴 3: 검색이 필요한데 큐 사용

**문제 상황**: “특정 사용자의 대기 중인 작업을 취소하고 싶어”

- 큐는 중간 요소 검색/삭제가 비효율적
- 해결: 해시테이블 + 큐 조합 또는 덱(deque) 사용

## 4. 성능 병목 예측과 대응

### 병목 시나리오 1: 큐 크기 무제한 증가

**상황**: 생산 속도 > 소비 속도 지속

```
증상: 메모리 사용량 계속 증가 → OOM 크래시
대응책:
1. 큐 크기 제한 + 백프레셔(backpressure)
2. 오래된 항목 자동 삭제 (TTL)
3. 소비자 스케일 아웃
4. 생산자 제한 (rate limiting)
```

### 병목 시나리오 2: 단일 소비자 병목

**상황**: 큐에는 작업이 쌓이는데 처리가 따라가지 못함

```
증상: 큐 크기는 계속 커지고 응답 시간 증가
대응책:
1. 멀티 워커 패턴
2. 작업 분할 (큰 작업을 작은 단위로)
3. 비동기 I/O 활용
4. 배치 처리로 효율성 향상
```

### 병목 시나리오 3: 메모리 vs 디스크 트레이드오프

**상황**: 큐 크기가 메모리 한계를 초과

```
선택지:
1. 인메모리 큐 (빠름, 휘발성)
2. 디스크 기반 큐 (느림, 영속성)
3. 하이브리드 (최근 데이터는 메모리, 오래된 것은 디스크)

실무 결정 기준:
- 데이터 손실 허용 여부
- 응답 시간 요구사항
- 비용 고려사항
```

## 5. 언어/플랫폼별 선택 가이드

### 상황별 구현 선택

|상황     |C/C++|Go|Java         |Python     |추천 이유 |
|-------|-----|--|-------------|-----------|------|
|임베디드/게임|배열 큐 |- |-            |-          |메모리 제어|
|웹 백엔드  |-    |채널|BlockingQueue|queue.Queue|동시성 지원|
|대용량 처리 |-    |- |Kafka        |Celery     |분산 처리 |
|실시간 시스템|락프리 큐|채널|-            |-          |성능 우선 |

### 코드 예시: 상황별 구현

```go
// Go - 실시간 로그 처리
func logProcessor() {
    logQueue := make(chan LogEntry, 10000)
    
    // 여러 워커로 병렬 처리
    for i := 0; i < runtime.NumCPU(); i++ {
        go func() {
            for log := range logQueue {
                processLog(log)
            }
        }()
    }
}
```

## 6. 실무 검증 체크리스트

### 설계 검토 질문들

**성능 검증:**

- [ ] 예상 트래픽에서 큐 크기 상한은?
- [ ] 최대 지연 시간이 SLA를 만족하는가?
- [ ] 메모리 사용량이 서버 한계 내인가?

**장애 대응:**

- [ ] 큐 서버가 다운되면 어떻게 복구하는가?
- [ ] 데이터 손실은 허용 가능한가?
- [ ] 순서가 바뀌어도 괜찮은가?

**모니터링:**

- [ ] 큐 크기를 실시간으로 모니터링하는가?
- [ ] 처리 지연 시간을 추적하는가?
- [ ] 에러율과 처리량을 측정하는가?

## 7. 실전 연습 문제

### 문제 1: 실시간 주식 거래 시스템

**요구사항**: 초당 10만건의 매매 주문을 처리해야 함
**고려사항**:

- 주문 순서가 수익에 직결
- 1ms 지연도 큰 손실
- 장애 시 데이터 손실 불허

**당신의 설계안:**

1. 어떤 자료구조를 선택하겠는가?
1. 병목점은 무엇이고 어떻게 해결하겠는가?
1. 장애 상황은 어떻게 대응하겠는가?

### 문제 2: 온라인 게임 이벤트 처리

**요구사항**: MMORPG에서 플레이어 액션을 실시간 처리
**고려사항**:

- 플레이어마다 독립적인 처리
- 일부 이벤트는 우선순위가 높음 (아이템 구매)
- 서버 간 동기화 필요

**당신의 설계안:**

1. 큐를 어떻게 분할하겠는가?
1. 우선순위는 어떻게 처리하겠는가?
1. 확장성은 어떻게 확보하겠는가?

## 8. 마스터리 체크포인트

다음 질문에 즉답할 수 있다면 큐 의사결정 능력을 갖춘 것입니다:

**Level 1: 기초 판단**

- “이 상황에서 왜 스택이 아니라 큐인가?”
- “메모리 기반 vs 디스크 기반 중 어떤 걸 선택할까?”

**Level 2: 성능 예측**

- “사용자 10배 증가 시 어떤 병목이 먼저 올까?”
- “큐 크기를 어떻게 정해야 할까?”

**Level 3: 아키텍처 설계**

- “마이크로서비스에서 큐를 어떻게 배치할까?”
- “장애 상황에서 데이터 일관성을 어떻게 보장할까?”

-----

이 프레임워크를 통해 큐라는 ‘도구’를 넘어서 ‘언제, 왜, 어떻게’ 사용할지 판단하는 실무 역량을 기를 수 있습니다.
