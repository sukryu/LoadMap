# Partitioning 전략

파티셔닝은 대규모 데이터베이스에서 단일 테이블 또는 데이터 집합이 너무 커져 발생할 수 있는 성능 저하, 관리 복잡성 등의 문제를 해결하기 위해 데이터를 여러 부분(파티션)으로 분할하는 전략입니다.  
이 문서에서는 파티셔닝의 개념, 다양한 전략 및 사용 사례, 그리고 트레이드오프를 설명합니다.

---

## 1. 개념 개요

파티셔닝은 데이터를 논리적 혹은 물리적으로 분리하여 저장함으로써, 데이터 처리 속도와 유지보수 효율을 향상시키는 기술입니다.  
주요 파티셔닝 방식은 다음과 같습니다.

### 1.1. Horizontal Partitioning (수평 파티셔닝 / 샤딩)

- **개념:**  
  전체 데이터를 행 단위로 분할하여 각 파티션에 저장합니다.  
  예를 들어, 고객 데이터를 지역별 또는 ID 범위별로 나누어 저장할 수 있습니다.

- **특징:**  
  - 쿼리 대상 데이터 범위를 좁혀 성능 향상
  - 대규모 데이터베이스에서 확장성과 부하 분산에 유리함

### 1.2. Vertical Partitioning (수직 파티셔닝)

- **개념:**  
  테이블의 열을 분리하여 여러 테이블에 나눠 저장합니다.  
  예를 들어, 자주 조회되는 핵심 열과 부가 정보를 분리하여 관리할 수 있습니다.

- **특징:**  
  - 필요한 열만 조회하여 I/O 부하를 줄임
  - 특정 컬럼에 대한 보안 및 접근 제어를 세분화할 수 있음

### 1.3. 기타 파티셔닝 방식

- **Range Partitioning:**  
  특정 컬럼 값의 범위에 따라 데이터를 분할합니다.  
  ex) 날짜, 연도별 분할

- **List Partitioning:**  
  미리 정의된 목록에 따라 데이터를 분할합니다.  
  ex) 국가, 지역 등

- **Hash Partitioning:**  
  해시 함수를 이용해 데이터를 균등하게 분할합니다.  
  ex) 사용자 ID에 기반한 분산

---

## 2. 문제 상황과 해결 방안

### 2.1. 문제 상황: 단일 테이블의 데이터 증가에 따른 성능 저하 및 관리 어려움

- **데이터 폭증:**  
  단일 테이블에 데이터가 집중되면, 인덱스 검색, 스캔, 업데이트 등 모든 쿼리의 성능이 저하됩니다.
  
- **관리 복잡성:**  
  백업, 복구, 유지보수 작업 시 대량의 데이터를 한꺼번에 처리해야 하므로 작업 시간이 길어지고, 장애 발생 시 복구가 어려워집니다.

### 2.2. 해결 방안: 파티셔닝 전략 적용

- **Horizontal Partitioning:**  
  대량의 데이터를 행 단위로 분할하여 쿼리 범위를 제한함으로써 성능을 개선합니다.
  
- **Vertical Partitioning:**  
  자주 조회하는 컬럼과 그렇지 않은 컬럼을 분리하여, 필요한 데이터만 빠르게 조회할 수 있도록 합니다.
  
- **혼합 전략:**  
  상황에 따라 수평 파티셔닝과 수직 파티셔닝을 혼합하여 적용할 수 있습니다.  
  예를 들어, 날짜 범위에 따른 수평 파티셔닝과 핵심 컬럼 분리를 통한 수직 파티셔닝을 동시에 적용하는 방식입니다.

---

## 3. 구체적 구현 방법 및 베스트 프랙티스

### 3.1. Horizontal Partitioning (샤딩) 구현 예시

MySQL을 예로 들어, 주문 내역 테이블을 주문 날짜를 기준으로 파티셔닝하는 방법입니다.

```sql
CREATE TABLE orders (
    order_id INT NOT NULL,
    order_date DATE NOT NULL,
    customer_id INT,
    amount DECIMAL(10,2),
    PRIMARY KEY (order_id, order_date)
)
PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p2019 VALUES LESS THAN (2020),
    PARTITION p2020 VALUES LESS THAN (2021),
    PARTITION p2021 VALUES LESS THAN (2022),
    PARTITION pmax VALUES LESS THAN MAXVALUE
);
```

- **베스트 프랙티스:**  
  - 파티션 키를 선정할 때, 쿼리 패턴과 데이터 분포를 고려합니다.
  - 각 파티션의 크기가 균등하도록 설계하여 특정 파티션에 부하가 집중되지 않도록 합니다.
  - 주기적으로 파티션을 재조정하거나, 오래된 파티션을 아카이브하는 전략을 사용합니다.

### 3.2. Vertical Partitioning 구현 예시

수직 파티셔닝의 경우, 테이블을 기능별로 분리하는 예시입니다.  
예를 들어, 사용자 테이블에서 기본 정보와 상세 프로필 정보를 분리할 수 있습니다.

```sql
-- 기본 사용자 정보 테이블
CREATE TABLE users_basic (
    user_id INT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL
);

-- 상세 프로필 정보 테이블
CREATE TABLE users_profile (
    user_id INT PRIMARY KEY,
    bio TEXT,
    profile_picture VARCHAR(255),
    FOREIGN KEY (user_id) REFERENCES users_basic(user_id)
);
```

- **베스트 프랙티스:**  
  - 자주 조회되는 데이터와 그렇지 않은 데이터를 분리하여, 쿼리 성능을 최적화합니다.
  - JOIN 연산 비용과 데이터 무결성을 고려하여, 필요한 경우 인덱스를 추가합니다.
  - 데이터 중복 및 동기화 문제를 방지하기 위해, 외래 키 제약조건과 트랜잭션 처리를 강화합니다.

---

## 4. 추가 고려 사항

- **쿼리 최적화와 인덱스 관리:**  
  파티셔닝된 테이블에서는 각 파티션별 인덱스 관리가 필요합니다.  
  쿼리가 특정 파티션만 스캔할 수 있도록 파티션 키와 인덱스 전략을 신중하게 설계해야 합니다.

- **운영 및 모니터링:**  
  파티셔닝 전략 적용 후, 각 파티션의 데이터 분포, 쿼리 응답 시간, 리소스 사용량 등을 모니터링하여 성능 저하나 불균형 현상을 조기에 감지할 수 있도록 합니다.

- **백업 및 복구 전략:**  
  파티션 단위로 데이터를 백업하고, 복구 시에도 파티션 단위로 복구할 수 있는 체계를 마련하는 것이 좋습니다.

- **확장성과 유지보수성:**  
  데이터 증가에 따라 새로운 파티션을 추가하거나 기존 파티션을 병합하는 전략을 미리 계획하여, 운영 중단 없이 시스템 확장이 가능하도록 합니다.

---

## 5. 결론

파티셔닝 전략은 대규모 데이터베이스의 성능 및 관리 효율성을 크게 향상시킬 수 있는 중요한 기술입니다.

- **Horizontal Partitioning (샤딩)** 은 데이터를 행 단위로 분할하여, 쿼리 성능 향상 및 확장성을 제공합니다.
- **Vertical Partitioning** 은 테이블의 열을 분리하여, 필요한 데이터만 빠르게 조회하고 관리할 수 있도록 돕습니다.
- **혼합 전략** 을 통해, 시스템 특성에 맞춰 최적의 성능과 관리 효율을 달성할 수 있습니다.

시스템의 요구사항과 데이터 특성을 정확히 분석한 후, 적절한 파티셔닝 전략을 선택하는 것이 안정적이고 효율적인 데이터베이스 운영의 핵심입니다.