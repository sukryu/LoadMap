# Cassandra: 분산 데이터베이스

Apache Cassandra는 대규모 분산 데이터 환경에서 높은 확장성과 가용성을 제공하는 오픈 소스 NoSQL 데이터베이스입니다. 높은 쓰기 처리량과 장애 복구 능력, 지리적 분산 클러스터링 등 다양한 기능을 갖추고 있어, 실시간 분석, 로그 저장, 시계열 데이터, IoT 및 소셜 미디어 데이터 처리 등 여러 분야에서 널리 사용됩니다.

---

## 1. Cassandra의 기본 개념

### 1.1. 분산 아키텍처

- **수평적 확장성:**  
  Cassandra는 노드를 추가함으로써 자동으로 데이터를 분산 저장하고, 전체 클러스터의 처리 용량과 저장 용량을 확장할 수 있습니다.  
- **탈중앙화:**  
  모든 노드가 동등한 역할을 수행하는 피어 투 피어(peer-to-peer) 구조를 채택하여, 단일 장애점(SPOF)이 존재하지 않습니다.
- **무중단 서비스:**  
  각 노드는 독립적으로 동작하며, 일부 노드에 장애가 발생해도 다른 노드가 데이터를 제공하므로, 높은 가용성을 유지합니다.

### 1.2. 데이터 모델

- **컬럼 패밀리(Column-Family):**  
  Cassandra는 데이터를 테이블이 아닌 컬럼 패밀리라는 개념으로 저장합니다.  
  각 컬럼 패밀리는 행(Row) 단위로 데이터를 저장하며, 각 행은 유연한 스키마를 가질 수 있습니다.
- **Partition Key와 Clustering Columns:**  
  - **Partition Key:** 데이터가 어느 노드에 저장될지를 결정하며, 분산과 부하 균형에 중요한 역할을 합니다.  
  - **Clustering Columns:** 파티션 내에서 데이터를 정렬하는 기준으로, 쿼리 성능 및 데이터 정렬에 영향을 줍니다.
- **Wide Row 구조:**  
  하나의 파티션에 수천에서 수백만 건의 행을 저장할 수 있어, 시계열 데이터나 이벤트 로그와 같이 데이터량이 많은 경우에 유리합니다.

### 1.3. 복제 및 일관성 모델

- **복제(Replication):**  
  Cassandra는 데이터를 여러 노드에 복제하여 저장합니다. 복제 팩터(Replication Factor, RF)를 설정하여, 각 데이터가 몇 개의 노드에 저장될지를 결정합니다.
- **일관성(Consistency):**  
  - **Eventual Consistency:**  
    기본적으로 최종적 일관성을 보장하며, 쓰기 작업 후 일정 시간이 지나면 모든 노드에 데이터가 동기화됩니다.
  - **조정 가능한 일관성 레벨:**  
    읽기와 쓰기 요청 시 일관성 레벨(예: ONE, QUORUM, ALL 등)을 선택할 수 있어, 성능과 데이터 일관성 간의 트레이드오프를 조정할 수 있습니다.

---

## 2. Cassandra 아키텍처 및 내부 동작

### 2.1. 노드와 클러스터 구성

- **노드:**  
  Cassandra 클러스터 내의 각 서버는 독립적인 노드로, 데이터를 저장하고 쿼리를 처리합니다.
- **데이터 분산:**  
  각 노드는 데이터 토큰(Token)을 기반으로 데이터를 저장하며, 토큰 링(Token Ring) 구조를 통해 데이터가 균등하게 분산됩니다.
- **가상 노드(Virtual Nodes, vnodes):**  
  단일 물리적 노드가 여러 개의 작은 토큰 범위를 관리하도록 하여, 데이터 분산과 부하 균형을 보다 정교하게 조절합니다.

### 2.2. 쓰기 및 읽기 경로

- **쓰기 경로:**  
  - **Commit Log:** 모든 쓰기 작업은 먼저 디스크의 Commit Log에 기록되어 내결함성을 보장합니다.  
  - **Memtable:** 이후 메모리 내의 Memtable에 기록되며, 일정 크기에 도달하면 SSTable(Immutable 데이터 파일)로 플러시됩니다.
- **읽기 경로:**  
  - 읽기 작업은 Memtable과 여러 개의 SSTable을 병합하여 수행됩니다.  
  - Bloom Filter와 Partition Index를 활용하여, 불필요한 SSTable 접근을 줄여 성능을 최적화합니다.

### 2.3. 복제 및 장애 복구

- **복제 전략:**  
  복제 팩터를 통해 동일한 데이터가 여러 노드에 저장되며, 노드 간의 데이터 동기화를 통해 장애 발생 시 빠른 복구가 가능합니다.
- **가용성:**  
  각 노드는 독립적으로 쿼리를 처리할 수 있어, 일부 노드 장애 시에도 클러스터 전체의 서비스는 유지됩니다.
- **Gossip 프로토콜:**  
  노드 간 상태를 주기적으로 교환하여, 클러스터의 건강 상태와 토큰 분포를 지속적으로 업데이트합니다.

---

## 3. 성능 최적화 및 관리 전략

### 3.1. 데이터 모델링 최적화

- **적절한 Partition Key 선택:**  
  데이터가 균등하게 분산되도록 Partition Key를 신중하게 선택합니다.  
  데이터 핫스팟(hotspot) 현상을 방지하기 위해, 파티션 크기를 적절하게 유지합니다.
- **Clustering Column 활용:**  
  데이터 조회 시 정렬 순서를 미리 정의하여, 쿼리 성능을 최적화합니다.

### 3.2. 인덱스와 쿼리 최적화

- **Secondary Index:**  
  필요한 경우, Secondary Index를 생성하여 비주요 컬럼에 대한 조회 성능을 개선할 수 있습니다. 단, 과도한 인덱스 생성은 쓰기 성능 저하를 초래할 수 있으므로 주의해야 합니다.
- **Materialized Views:**  
  자주 사용되는 복잡한 쿼리를 미리 계산하여 저장하는 Materialized Views 기능을 활용하면, 조회 성능을 향상시킬 수 있습니다.

### 3.3. 클러스터 모니터링 및 유지보수

- **노드 상태 모니터링:**  
  JMX, Nodetool, 그리고 다양한 모니터링 도구를 활용하여, 각 노드의 상태, 읽기/쓰기 지연, 메모리 사용량 등을 지속적으로 점검합니다.
- **데이터 정리:**  
  주기적인 Compaction 작업과 Garbage Collection을 통해 SSTable을 정리하고, 불필요한 데이터 조각을 제거하여 성능을 유지합니다.
- **백업 및 복구:**  
  스냅샷(Snapshot) 기능과 Incremental Backup 기능을 활용하여, 정기적인 백업 및 테스트된 복구 전략을 마련합니다.

---

## 4. Cassandra 활용 사례

### 4.1. 실시간 로그 및 이벤트 데이터 저장

- **웹 로그 분석:**  
  대규모 웹사이트나 애플리케이션의 방문자 로그, 이벤트 로그 등을 저장하여, 실시간 분석 및 모니터링 시스템의 백엔드로 활용됩니다.
- **IoT 데이터:**  
  수많은 IoT 기기에서 발생하는 센서 데이터를 저장하고, 시간에 따른 변화 분석, 실시간 경보 시스템 등에 적용됩니다.

### 4.2. 소셜 미디어 및 추천 시스템

- **사용자 활동 데이터:**  
  소셜 네트워크에서 발생하는 사용자 활동(좋아요, 공유, 댓글 등)을 분산 저장하여, 빠른 실시간 응답과 높은 처리량을 보장합니다.
- **추천 알고리즘:**  
  사용자 행동 데이터를 기반으로 추천 엔진을 구축하는 데 적합하며, 데이터의 분산 처리와 확장성이 핵심 역할을 합니다.

### 4.3. 금융 및 거래 시스템

- **거래 로그:**  
  금융 거래, 주식 거래 등 빈번한 쓰기 작업이 발생하는 시스템에서 Cassandra의 높은 쓰기 처리량과 장애 복구 기능을 활용할 수 있습니다.
- **실시간 분석:**  
  거래 데이터를 실시간으로 분석하여 이상 거래 탐지, 실시간 리포팅 등의 기능을 구현합니다.

---

## 5. 결론

Apache Cassandra는 분산 환경에서 높은 확장성과 가용성, 빠른 쓰기 처리 능력을 제공하는 강력한 NoSQL 데이터베이스입니다.  
- **데이터 모델링:** 적절한 Partition Key와 Clustering Column 설계를 통해 데이터 분포와 쿼리 성능을 최적화할 수 있습니다.  
- **복제와 장애 복구:** 복제 팩터와 피어 투 피어 아키텍처를 통해 단일 장애점 없이 높은 가용성을 유지할 수 있습니다.  
- **분산 처리:** 샤딩, 자동 페일오버, 그리고 지속적인 노드 모니터링으로 대규모 데이터 및 트래픽을 효율적으로 처리합니다.

Cassandra는 실시간 로그 저장, IoT 데이터, 소셜 미디어, 금융 거래 등 다양한 분야에서 효과적으로 활용되고 있으며, 복잡한 분산 환경에서도 안정적인 데이터 관리를 구현할 수 있습니다.  
프로젝트의 요구사항에 따라 데이터 모델링, 복제 전략, 모니터링, 백업 전략 등을 종합적으로 고려하여 Cassandra를 도입하면, 대규모 분산 시스템에서 우수한 성능과 확장성을 경험할 수 있습니다.

---

이 문서를 통해 Apache Cassandra의 개념, 아키텍처, 성능 최적화 전략 및 활용 사례를 자세히 이해하고, 실제 분산 환경에서의 Cassandra 도입 및 운영 전략 수립에 도움이 되길 바랍니다.