# MongoDB 사용법과 사례

MongoDB는 문서 지향(Document-Oriented) NoSQL 데이터베이스로, JSON과 유사한 BSON(Binary JSON) 형식으로 데이터를 저장합니다. 유연한 스키마와 수평적 확장성, 높은 가용성을 제공하며, 다양한 애플리케이션(웹, 모바일, IoT 등)에서 빠른 개발과 실시간 데이터 처리가 필요한 경우에 널리 사용됩니다.

---

## 1. MongoDB의 기본 개념

- **문서(Document):**  
  데이터는 BSON 형식의 문서로 저장되며, 각 문서는 JSON과 유사한 구조를 가지고 있어 계층적 데이터를 자연스럽게 표현할 수 있습니다.
  
- **컬렉션(Collection):**  
  문서의 집합을 컬렉션이라고 하며, RDBMS의 테이블에 해당합니다. 컬렉션은 스키마가 없기 때문에, 각 문서마다 구조가 달라도 무방합니다.
  
- **유연한 스키마:**  
  데이터 구조를 사전에 고정하지 않고 필요에 따라 확장할 수 있어, 초기 개발 단계나 데이터 모델이 자주 변하는 환경에 유리합니다.
  
- **수평적 확장성:**  
  샤딩(sharding)을 통해 데이터를 여러 서버에 분산 저장하여 대규모 트래픽과 데이터 증가에 효과적으로 대응할 수 있습니다.
  
- **복제 및 고가용성:**  
  복제(replication)를 통해 데이터의 복사본을 여러 노드에 저장하여, 하나의 노드에 장애가 발생해도 시스템 전체의 가용성을 유지합니다.

---

## 2. MongoDB 사용법

### 2.1. 설치 및 환경 설정

- **설치 방법:**  
  MongoDB는 공식 웹사이트에서 제공하는 설치 파일 또는 패키지 관리 도구(예: `apt`, `yum`, Homebrew 등)를 통해 설치할 수 있습니다.
  ```bash
  # 예시: Ubuntu에서 MongoDB 설치
  sudo apt update
  sudo apt install -y mongodb
  ```
  
- **서비스 시작 및 확인:**  
  설치 후 MongoDB 데몬을 실행하고, 서비스 상태를 확인합니다.
  ```bash
  sudo systemctl start mongodb
  sudo systemctl status mongodb
  ```
  
- **MongoDB 쉘 접속:**  
  터미널에서 `mongo` 명령어를 실행하여 MongoDB 쉘에 접속합니다.
  ```bash
  mongo
  ```

### 2.2. 데이터베이스 및 컬렉션 관리

- **데이터베이스 생성 및 사용:**  
  MongoDB에서는 명시적으로 데이터베이스를 생성하지 않고, 해당 데이터베이스를 선택할 때 자동으로 생성됩니다.
  ```javascript
  // MongoDB 쉘에서
  use myDatabase  // myDatabase가 존재하지 않으면 새로 생성됨
  ```
  
- **컬렉션 생성:**  
  컬렉션은 데이터를 처음 삽입할 때 자동으로 생성되지만, 명시적으로 생성할 수도 있습니다.
  ```javascript
  db.createCollection("users")
  ```

### 2.3. CRUD 작업

#### 2.3.1. 문서 삽입 (Create)

- **단일 문서 삽입:**
  ```javascript
  db.users.insertOne({
      username: "alice",
      email: "alice@example.com",
      age: 30,
      interests: ["reading", "traveling"]
  })
  ```

- **여러 문서 삽입:**
  ```javascript
  db.users.insertMany([
      { username: "bob", email: "bob@example.com", age: 25 },
      { username: "charlie", email: "charlie@example.com", age: 35 }
  ])
  ```

#### 2.3.2. 문서 조회 (Read)

- **전체 문서 조회:**
  ```javascript
  db.users.find()
  ```
  
- **조건에 따른 조회:**
  ```javascript
  // 나이가 30 이상인 사용자
  db.users.find({ age: { $gte: 30 } })
  ```
  
- **특정 필드만 선택:**
  ```javascript
  db.users.find({}, { username: 1, email: 1, _id: 0 })
  ```

#### 2.3.3. 문서 수정 (Update)

- **단일 문서 수정:**
  ```javascript
  db.users.updateOne(
      { username: "alice" },
      { $set: { age: 31 } }
  )
  ```
  
- **여러 문서 수정:**
  ```javascript
  db.users.updateMany(
      { age: { $lt: 30 } },
      { $inc: { age: 1 } }
  )
  ```

#### 2.3.4. 문서 삭제 (Delete)

- **단일 문서 삭제:**
  ```javascript
  db.users.deleteOne({ username: "charlie" })
  ```
  
- **여러 문서 삭제:**
  ```javascript
  db.users.deleteMany({ age: { $lt: 26 } })
  ```

### 2.4. 고급 쿼리 및 집계

- **Aggregation Pipeline:**  
  복잡한 데이터 집계 작업을 수행할 때 사용합니다.
  ```javascript
  db.orders.aggregate([
      { $match: { status: "completed" } },
      { $group: { _id: "$customerId", totalAmount: { $sum: "$amount" } } },
      { $sort: { totalAmount: -1 } }
  ])
  ```
  
- **인덱스 활용:**  
  인덱스를 생성하여 쿼리 성능을 향상시킬 수 있습니다.
  ```javascript
  // username 필드에 인덱스 생성
  db.users.createIndex({ username: 1 })
  ```

### 2.5. 복제와 샤딩

- **복제:**  
  복제 세트를 구성하여 데이터의 가용성과 내결함성을 높입니다.
  - **설정 예시:**  
    MongoDB 설정 파일(`mongod.conf`)에서 복제 세트 이름을 지정한 후, 각 노드에 대해 복제 세트를 구성합니다.
    ```yaml
    replication:
      replSetName: "rs0"
    ```
    ```bash
    # 각 노드에서 mongod 실행 후, primary 노드에서 초기화
    mongo
    rs.initiate()
    rs.add("hostname:port")
    ```

- **샤딩:**  
  대규모 데이터 처리를 위해 데이터를 여러 샤드로 분할하여 저장합니다.
  - **샤딩 활성화:**  
    ```javascript
    // 샤딩을 사용하려는 데이터베이스 선택
    use myDatabase
    // 샤딩 활성화
    sh.enableSharding("myDatabase")
    // 특정 컬렉션에 대해 샤딩 설정 (예: shard key로 username 사용)
    sh.shardCollection("myDatabase.users", { username: 1 })
    ```

---

## 3. MongoDB 활용 사례

### 3.1. 콘텐츠 관리 및 사용자 데이터 저장

- **CMS 및 블로그 플랫폼:**  
  MongoDB는 유연한 스키마 덕분에 다양한 형태의 콘텐츠(게시글, 댓글, 미디어 파일 등)를 저장하기에 적합합니다.
  
- **사용자 프로필:**  
  사용자 정보가 자주 변경되거나, 다양한 속성이 추가될 수 있는 경우 MongoDB의 동적 스키마는 큰 장점으로 작용합니다.

### 3.2. 실시간 분석 및 로그 저장

- **이벤트 로그 및 분석:**  
  대량의 로그 데이터를 빠르게 저장하고, 집계 파이프라인을 통해 실시간 분석할 수 있습니다.  
  예를 들어, 웹사이트 방문자 로그를 수집하여 시간대별 트래픽 패턴 분석에 활용됩니다.

### 3.3. IoT 및 센서 데이터 저장

- **시계열 데이터:**  
  IoT 기기에서 발생하는 센서 데이터를 MongoDB에 저장하고, 집계 기능을 통해 실시간 모니터링 및 분석 시스템을 구축할 수 있습니다.
  
- **데이터의 빠른 쓰기:**  
  빠른 쓰기 성능과 유연한 스키마 덕분에, 다양한 기기에서 발생하는 데이터를 효율적으로 저장할 수 있습니다.

### 3.4. 분산 시스템 및 클라우드 네이티브 애플리케이션

- **클라우드 기반 애플리케이션:**  
  MongoDB의 복제와 샤딩 기능을 활용하면, 클라우드 환경에서 높은 가용성과 확장성을 갖춘 애플리케이션을 구축할 수 있습니다.
  
- **마이크로서비스 아키텍처:**  
  각 서비스별로 독립적인 데이터 저장소로 활용하거나, 공통 데이터베이스로 사용하여, 데이터 일관성을 유지하면서도 서비스 확장이 용이합니다.

---

## 4. 모범 사례 및 주의점

### 4.1. 데이터 모델링

- **스키마 설계:**  
  MongoDB는 유연한 스키마를 제공하지만, 초기에 데이터 모델을 잘 설계해야 나중에 데이터 중복, 업데이트 문제 등이 발생하지 않습니다.
  
- **참조와 내장 문서:**  
  데이터 간의 관계를 어떻게 모델링할지 결정할 때, 내장 문서(embed)와 참조(reference)의 장단점을 고려하여 설계합니다.
  - **내장 문서:** 읽기 성능이 좋고, 데이터가 자주 함께 조회되는 경우에 유리합니다.
  - **참조:** 데이터 중복을 줄이고, 개별 데이터 업데이트가 필요한 경우에 적합합니다.

### 4.2. 인덱스 및 쿼리 최적화

- **인덱스 관리:**  
  쿼리 성능을 높이기 위해 자주 조회되는 필드에 대해 인덱스를 생성하고, 정기적으로 인덱스 사용 현황을 모니터링합니다.
  
- **Aggregation Pipeline 최적화:**  
  복잡한 집계 쿼리의 경우, 각 단계에서 처리되는 데이터 양을 줄일 수 있도록 초기 필터링($match)과 같은 최적화 기법을 활용합니다.

### 4.3. 복제와 샤딩 전략

- **복제 세트 구성:**  
  데이터의 안정성을 위해 적절한 복제 세트를 구성하고, 읽기/쓰기 부하에 따라 읽기 전용 복제본을 활용합니다.
  
- **샤딩 키 선택:**  
  샤딩을 사용할 때는 데이터 분포와 쿼리 패턴을 고려하여 적절한 샤딩 키를 선택합니다.

### 4.4. 보안 및 백업

- **보안 설정:**  
  인증, 권한 관리, SSL/TLS 암호화를 통해 데이터 전송 및 접근 보안을 강화합니다.
  
- **백업 전략:**  
  정기적인 백업과 복구 테스트를 통해, 장애 발생 시 데이터 손실을 최소화합니다.

---

## 5. 결론

MongoDB는 유연한 스키마, 수평적 확장성, 복제 및 샤딩 기능 등으로 인해 다양한 애플리케이션 환경에서 효과적으로 활용될 수 있는 강력한 NoSQL 데이터베이스입니다.  
- **콘텐츠 관리, 사용자 데이터 저장, 실시간 분석, IoT 데이터 처리 등** 다양한 분야에서 빠른 개발과 높은 확장성을 보장합니다.  
- 적절한 데이터 모델링, 인덱스 최적화, 복제 및 샤딩 전략, 보안과 백업 정책을 통해 안정적이고 효율적인 데이터 관리를 구현할 수 있습니다.

이 문서를 통해 MongoDB의 사용법과 다양한 활용 사례를 자세히 이해하고, 실제 프로젝트에 맞춰 최적의 데이터베이스 아키텍처를 설계하는 데 참고하시길 바랍니다.

---