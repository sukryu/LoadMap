# 다차원 누적합 이론 정리

다차원 누적합(Multi-Dimensional Prefix Sum)은 1차원 누적합의 개념을 확장하여 2차원 이상의 배열(행렬, 3차원 배열 등)에서 특정 영역의 합을 빠르게 계산할 수 있도록 하는 강력한 기법입니다.  
이 문서에서는 다차원 누적합의 기본 원리, 구성 방법, 응용 문제 유형 및 주의사항을 초보자도 쉽게 이해할 수 있도록 자세하게 설명합니다.

---

## 1. 기본 개념

- **정의:**  
  다차원 누적합은 다차원 배열의 각 위치까지의 합을 미리 계산해두어, 이후 특정 영역(부분 배열, 서브 매트릭스 등)의 합을 빠르게 계산하는 기법입니다.

- **목적:**  
  반복적인 영역 합 계산을 매번 처음부터 수행하지 않고, 미리 계산된 누적합 정보를 활용하여 O(1) 또는 매우 빠른 시간 내에 구간 합을 조회할 수 있습니다.

- **예시:**  
  - **2차원 누적합:** 행렬의 특정 사각형 영역의 합을 빠르게 계산
  - **3차원 누적합:** 3차원 공간에서 직육면체 영역의 합을 효율적으로 구하기

---

## 2. 다차원 누적합 구성 방법

### 2.1 2차원 누적합

- **누적합 배열 구성:**  
  주어진 2차원 배열 `A` (행: `rows`, 열: `cols`)에 대해 누적합 배열 `P`를 다음과 같이 정의합니다.
  - 일반적으로 `P[i][j]`는 원본 배열 `A`의 좌상단 (0,0)부터 (i-1, j-1)까지의 합을 의미합니다.
  
- **점화식 (1-indexed 기준):**  
  ```
  P[i][j] = P[i-1][j] + P[i][j-1] - P[i-1][j-1] + A[i-1][j-1]
  ```
  이를 통해 영역 `(r1, c1)`부터 `(r2, c2)`의 합은 다음과 같이 계산할 수 있습니다.
  ```
  영역 합 = P[r2+1][c2+1] - P[r1][c2+1] - P[r2+1][c1] + P[r1][c1]
  ```

### 2.2 3차원 누적합

- **누적합 배열 구성:**  
  주어진 3차원 배열 `A` (크기: X × Y × Z)에 대해 누적합 배열 `P`를 구성하면,  
  `P[i][j][k]`는 (0,0,0)부터 (i-1, j-1, k-1)까지의 합을 나타냅니다.

- **점화식 (1-indexed 기준):**  
  ```
  P[i][j][k] = P[i-1][j][k] + P[i][j-1][k] + P[i][j][k-1]
                - P[i-1][j-1][k] - P[i-1][j][k-1] - P[i][j-1][k-1]
                + P[i-1][j-1][k-1] + A[i-1][j-1][k-1]
  ```
  이 식을 통해 3차원 공간의 직육면체 영역의 합을 O(1)에 계산할 수 있습니다.

---

## 3. 응용 문제 유형

- **영역 합 계산 문제:**  
  2차원 행렬이나 3차원 배열에서 주어진 영역의 합을 빠르게 계산해야 하는 문제에서 다차원 누적합 기법을 사용하면 매우 효율적입니다.

- **데이터 분석 및 이미지 처리:**  
  이미지의 특정 영역의 픽셀 값 합계나 평균값을 구하는 문제에 적용할 수 있습니다.

- **동적 계획법의 보조 도구:**  
  누적합 배열을 사용하여 상태 전이를 빠르게 계산하거나, 반복되는 영역 합 계산을 최적화할 때 활용할 수 있습니다.

---

## 4. 시간 및 공간 복잡도

- **2차원 누적합:**  
  - 누적합 배열 구성: O(rows × cols)
  - 각 영역 합 계산: O(1)
  - 추가 공간: O(rows × cols)

- **3차원 누적합:**  
  - 누적합 배열 구성: O(X × Y × Z)
  - 각 영역 합 계산: O(1)
  - 추가 공간: O(X × Y × Z)

---

## 5. 주의사항

- **인덱스 관리:**  
  0-indexed와 1-indexed의 차이에 유의하여 누적합 배열을 구성해야 합니다.
  
- **경계 조건:**  
  누적합 배열의 첫 행, 첫 열(또는 첫 면)은 0으로 초기화하여 점화식을 올바르게 적용해야 합니다.

- **메모리 사용:**  
  다차원 배열의 경우 추가 메모리 사용량이 커질 수 있으므로, 문제의 크기에 따라 메모리 제한을 주의해야 합니다.

- **업데이트 문제:**  
  배열의 값이 자주 변경되는 경우, 누적합 배열을 다시 계산해야 하므로 세그먼트 트리, 펜윅 트리(Fenwick Tree) 등의 자료구조를 고려할 수 있습니다.

---

## 6. 결론

다차원 누적합 기법은 다차원 배열에서 반복적인 영역 합 계산을 효율적으로 처리할 수 있는 강력한 도구입니다.  
문제 해결 시 영역 합을 O(1)에 계산할 수 있어 시간 복잡도를 크게 줄일 수 있으며, 이미지 처리, 데이터 분석, 동적 계획법 보조 등 다양한 응용 분야에서 활용됩니다.

이 문서를 통해 다차원 누적합의 원리와 구현 방법을 충분히 이해하고, 코딩 테스트 및 실제 문제 해결에 효과적으로 활용하시길 바랍니다.