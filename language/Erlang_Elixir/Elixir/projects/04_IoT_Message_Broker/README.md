# IoT 메시지 브로커 프로젝트

## 프로젝트 개요
이 프로젝트는 OTP와 Elixir의 고동시성, 분산 처리, 내결함성 기능을 활용하여 **IoT 메시지 브로커**를 구현한 예제입니다.  
본 시스템은 다양한 IoT 기기에서 생성되는 데이터를 중앙에서 수집하고, 이를 목적지(예: 데이터 분석 시스템, 클라우드 저장소, 경보 시스템 등)로 실시간 라우팅합니다.  
프로젝트는 높은 처리량과 빠른 응답성을 보장하며, 장애 발생 시 자동 복구 및 재시작 기능을 통해 안정적인 서비스를 제공합니다.

---

## 주요 기능
- **실시간 메시지 라우팅:**  
  IoT 기기에서 전송된 메시지를 실시간으로 수신하고, 구독자 또는 특정 대상 시스템으로 즉시 전달합니다.
  
- **고동시성 처리:**  
  경량 프로세스와 OTP Supervisor를 활용하여 수많은 동시 연결과 메시지 전송을 효율적으로 관리합니다.
  
- **오류 복구 및 자동 재시작:**  
  Supervisor가 메시지 브로커 및 핸들러 프로세스를 감시하고, 장애 발생 시 자동으로 재시작하여 서비스 중단을 최소화합니다.
  
- **분산 노드 통신:**  
  Erlang의 분산 기능을 이용하여 여러 노드에 걸친 브로커 클러스터를 구성할 수 있어, 확장성과 고가용성을 확보합니다.
  
- **유연한 메시지 처리:**  
  다양한 IoT 프로토콜(MQTT, CoAP 등)과 연동할 수 있으며, 메시지 포맷 변환 및 필터링 기능을 통해 필요에 맞게 데이터를 가공할 수 있습니다.

---

## 시스템 아키텍처

### 프로세스 구조
- **메시지 브로커 서버:**  
  - IoT 기기 및 클라이언트로부터 메시지를 수신하는 중앙 역할을 수행합니다.
  - 수신한 메시지를 분석하고, 구독자에게 브로드캐스트하거나 특정 대상 시스템으로 라우팅합니다.
  
- **메시지 핸들러 프로세스:**  
  - 개별 메시지를 처리하여 데이터 변환, 필터링, 우선순위 지정 등의 작업을 수행합니다.
  - 각 핸들러는 독립적으로 실행되어, 하나의 프로세스 실패가 전체 시스템에 영향을 주지 않습니다.
  
- **Supervisor 트리:**  
  - 메시지 브로커와 핸들러 프로세스의 생명주기를 관리하며, 장애 발생 시 자동 재시작하여 시스템의 내결함성을 보장합니다.
  
- **분산 노드 통신:**  
  - 여러 서버 노드를 클러스터로 구성하여, 노드 간 메시지 전달 및 데이터 동기화를 지원합니다.

### OTP 구성 요소 활용
- **GenServer:**  
  메시지 브로커의 상태 관리와 메시지 라우팅 로직을 구현하는 데 사용됩니다.
  
- **Supervisor:**  
  각 프로세스의 오류를 감시하고, 실패 시 자동으로 재시작하여 서비스의 안정성을 확보합니다.
  
- **ETS (Erlang Term Storage):**  
  고속 데이터 저장 및 조회를 위해 사용되며, 실시간 메시지 캐싱에 활용될 수 있습니다.
  
- **분산 기능:**  
  Erlang의 노드 간 통신 메커니즘을 통해, 클러스터 환경에서 데이터를 동기화하고 분산 처리할 수 있습니다.

---

## 설치 및 실행 방법

### 요구 사항
- Erlang/OTP 24 이상
- Elixir 1.12 이상
- Linux, macOS 또는 Windows 운영체제
- 네트워크 연결 환경 및 클러스터 구성 (분산 기능 사용 시)

### 설치 방법

1. **Erlang/OTP 및 Elixir 설치**
   - **Ubuntu/Debian:**
     ```bash
     sudo apt-get update
     sudo apt-get install erlang elixir
     ```
   - **macOS (Homebrew):**
     ```bash
     brew install erlang elixir
     ```
   - **Windows:**
     - [Elixir 공식 웹사이트](https://elixir-lang.org/install.html)에서 설치 프로그램을 다운로드하거나, Chocolatey를 이용:
       ```bash
       choco install erlang
       choco install elixir
       ```

2. **프로젝트 클론**
   ```bash
   git clone https://github.com/your-repo/iot-message-broker.git
   cd iot-message-broker
   ```

3. **컴파일**
   - 프로젝트 루트에서 Mix를 이용해 소스 파일들을 컴파일합니다.
     ```bash
     mix compile
     ```

### 실행 방법

1. **IEx 셸 시작**
   ```bash
   iex -S mix
   ```

2. **메시지 브로커 서버 시작**
   - IEx 셸에서 다음 명령을 실행하여 메시지 브로커를 시작합니다.
     ```elixir
     IotMessageBroker.start()
     ```
   - 서버는 클라이언트와 IoT 기기로부터의 메시지를 수신할 준비를 합니다.

3. **메시지 전송 및 테스트**
   - 별도의 IEx 셸이나 클라이언트 모듈을 통해 테스트 메시지를 전송합니다.
     ```elixir
     IotMessageBroker.send_message(%{device_id: "sensor_01", data: 23.5})
     ```
   - 전송된 메시지는 로그에 출력되거나, 구독자에게 브로드캐스트됩니다.

4. **분산 클러스터 구성 (선택 사항)**
   - 여러 노드를 연결하여 분산 브로커 클러스터를 구성하고, 노드 간 데이터 동기화 및 복제 기능을 테스트할 수 있습니다.
     ```elixir
     Node.connect(:"node2@hostname")
     IotMessageBroker.sync()
     ```

---

## 코드 구조

- **src/iot_message_broker.ex:**  
  메시지 브로커의 핵심 로직을 구현한 모듈로, 메시지 수신, 처리 및 라우팅 기능을 포함합니다.
  
- **src/iot_handler.ex:**  
  개별 메시지의 처리와 변환, 필터링, 우선순위 지정 등의 기능을 담당하는 핸들러 모듈입니다.
  
- **src/supervisor_iot.ex:**  
  Supervisor 트리를 구성하여, 메시지 브로커와 핸들러 프로세스의 생명주기를 관리합니다.
  
- **README.md:**  
  이 문서는 프로젝트 개요, 설치 및 실행 방법, 시스템 아키텍처, 확장 계획 등을 상세히 설명합니다.

---

## 예제 사용 시나리오

1. **서버 시작:**  
   메시지 브로커를 실행하여, IoT 기기 및 클라이언트의 연결 요청을 대기합니다.
   
2. **메시지 전송:**  
   IoT 기기 또는 클라이언트가 메시지를 전송하면, 브로커는 이를 수신하여 로그에 기록하고, 필요한 경우 특정 대상(예: 데이터 분석 시스템)으로 전달합니다.
   
3. **메시지 처리:**  
   개별 핸들러 프로세스가 수신된 메시지를 처리하여, 데이터 변환, 필터링, 우선순위 지정 등의 작업을 수행합니다.
   
4. **분산 동기화 및 복제:**  
   다수의 노드에 걸쳐 메시지가 복제되어, 한 노드에서 장애가 발생해도 다른 노드에서 데이터에 접근할 수 있습니다.
   
5. **오류 복구:**  
   Supervisor가 각 프로세스의 장애를 감시하고, 실패한 프로세스를 자동으로 재시작하여 시스템 연속성을 유지합니다.

---

## 개발 및 확장 계획

- **프로토콜 확장:**  
  MQTT, CoAP 등 다양한 IoT 통신 프로토콜 지원을 추가하여, 다양한 기기와의 호환성을 강화합니다.
  
- **웹 기반 대시보드:**  
  실시간 모니터링, 메시지 트래픽 분석, 노드 상태 확인 등을 위한 웹 대시보드를 도입하여, 관리자의 편의성을 높입니다.
  
- **보안 강화:**  
  데이터 암호화, 인증, 접근 제어 등의 보안 기능을 추가하여, 민감한 IoT 데이터를 안전하게 처리합니다.
  
- **데이터 저장 및 분석:**  
  처리된 메시지 데이터를 장기 저장하고, 이를 기반으로 실시간 분석 및 예측 기능을 도입할 계획입니다.

---

## 참고 자료

- [Programming Erlang - Joe Armstrong](https://pragprog.com/titles/jjoe/programming-erlang/)
- [Learn You Some Erlang for Great Good! - Fred Hebert](http://learnyousomeerlang.com/)
- [Elixir 공식 문서](https://hexdocs.pm/elixir/)
- [OTP Design Principles](https://erlang.org/doc/design_principles/)

---

이 프로젝트는 OTP와 Elixir를 활용한 분산 시스템의 핵심 개념을 실전에서 경험할 수 있도록 설계되었습니다.  
IoT 메시지 브로커를 통해 실시간 데이터 처리, 분산 통신, 내결함성 및 자동 복구 등의 원리를 깊이 이해하고, 실제 운영 환경에 적용할 수 있는 기반을 마련하시기 바랍니다.

의견이나 개선 사항은 [이슈 트래커](https://github.com/your-repo/iot-message-broker/issues)를 통해 공유해 주시기 바랍니다.

Happy coding!