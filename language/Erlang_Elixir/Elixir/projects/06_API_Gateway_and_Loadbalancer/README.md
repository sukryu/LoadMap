# API Gateway 및 로드 밸런서 프로젝트

## 프로젝트 개요
이 프로젝트는 OTP와 Elixir의 강력한 동시성, 분산 처리, 내결함성 기능을 활용하여 **API Gateway 및 로드 밸런서**를 구현한 예제입니다.  
본 시스템은 클라이언트로부터 들어오는 API 요청을 중앙에서 받아, 이를 적절한 백엔드 서비스로 라우팅하고, 부하를 균등하게 분산시켜 전체 시스템의 안정성과 확장성을 보장합니다.  
또한, 서비스 헬스 체크와 동적 백엔드 등록 기능을 통해, 장애 발생 시 자동으로 요청을 정상 인스턴스로 전환하는 기능을 제공합니다.

---

## 주요 기능
- **API 요청 라우팅:**  
  클라이언트로부터 들어오는 API 요청을 분석하여, 요청 경로 및 메서드에 따라 적절한 백엔드 서비스로 전달합니다.
  
- **부하 분산 (로드 밸런싱):**  
  다수의 백엔드 인스턴스에 요청을 균등하게 분배하여, 특정 서버에 과도한 부하가 걸리지 않도록 합니다.
  
- **서비스 헬스 체크:**  
  주기적으로 백엔드 서비스의 상태를 점검하고, 장애 발생 시 해당 인스턴스를 로드 밸런싱 목록에서 자동으로 제외합니다.
  
- **동적 백엔드 등록 및 제거:**  
  백엔드 서비스 인스턴스를 실시간으로 추가하거나 제거할 수 있어, 시스템 확장 및 유지보수가 용이합니다.
  
- **오류 복구 및 자동 재시작:**  
  Supervisor가 API Gateway 및 로드 밸런서 관련 프로세스를 감시하여, 오류 발생 시 자동 재시작을 수행함으로써 내결함성을 보장합니다.
  
- **분산 처리 지원:**  
  Erlang의 분산 기능을 활용하여, 여러 노드에 걸쳐 클러스터 환경에서 운영할 수 있습니다.

---

## 시스템 아키텍처

### 프로세스 구조
- **API Gateway 서버:**  
  - 클라이언트의 API 요청을 수신하고, 라우팅 로직을 통해 적절한 백엔드 서비스로 전달합니다.
  - 요청 처리 및 상태 관리는 GenServer를 통해 수행됩니다.
  
- **로드 밸런서 모듈:**  
  - 백엔드 인스턴스의 상태를 모니터링하고, 헬스 체크 결과에 따라 요청을 분배합니다.
  - 동적 백엔드 등록, 제거 및 헬스 체크 로직을 포함합니다.
  
- **헬스 체크 프로세스:**  
  - 백엔드 서비스의 상태를 주기적으로 확인하여, 장애가 있는 인스턴스를 감지합니다.
  
- **Supervisor 트리:**  
  - API Gateway, 로드 밸런서 및 헬스 체크 프로세스의 생명주기를 관리합니다.
  - 프로세스 오류 발생 시 자동으로 재시작하여 시스템의 안정성을 유지합니다.
  
- **분산 노드 통신:**  
  - 여러 노드 간에 메시지 전달과 데이터 동기화를 지원하여, 클러스터 환경에서 운영할 수 있습니다.

### OTP 구성 요소 활용
- **GenServer:**  
  - API Gateway 및 로드 밸런서 모듈의 상태 관리와 메시지 처리 로직을 구현합니다.
  
- **Supervisor:**  
  - 전체 시스템의 프로세스를 감시하고, 장애 발생 시 정의된 재시작 전략에 따라 프로세스를 복구합니다.
  
- **ETS:**  
  - 빠른 조회와 캐싱을 위해 API 라우팅 및 헬스 체크 데이터를 저장하는 데 활용할 수 있습니다.
  
- **분산 처리:**  
  - 노드 간 통신을 통해, 여러 서버가 하나의 클러스터로 연동되어 동시 다발적인 API 요청을 처리할 수 있습니다.

---

## 설치 및 실행 방법

### 요구 사항
- Erlang/OTP 24 이상
- Elixir 1.12 이상
- Linux, macOS 또는 Windows 운영체제
- 네트워크 연결 및 분산 클러스터 구성 환경 (분산 기능 사용 시)

### 설치 방법

1. **Erlang/OTP 및 Elixir 설치**
   - **Ubuntu/Debian:**
     ```bash
     sudo apt-get update
     sudo apt-get install erlang elixir
     ```
   - **macOS (Homebrew):**
     ```bash
     brew install erlang elixir
     ```
   - **Windows:**
     - [Elixir 공식 웹사이트](https://elixir-lang.org/install.html)에서 설치 프로그램을 다운로드하거나, Chocolatey를 이용:
       ```bash
       choco install erlang
       choco install elixir
       ```

2. **프로젝트 클론**
   ```bash
   git clone https://github.com/your-repo/api-gateway-load-balancer.git
   cd api-gateway-load-balancer
   ```

3. **컴파일**
   - 프로젝트 루트 디렉토리에서 Mix를 사용하여 소스 파일들을 컴파일합니다.
     ```bash
     mix compile
     ```

### 실행 방법

1. **IEx 셸 시작**
   ```bash
   iex -S mix
   ```

2. **API Gateway 및 로드 밸런서 시작**
   - IEx 셸에서 다음 명령을 실행하여 시스템을 시작합니다.
     ```elixir
     ApiGateway.start()
     ```
   - 서버는 클라이언트 요청을 수신하고, 백엔드 인스턴스에 요청을 분배할 준비를 합니다.

3. **백엔드 서비스 등록**
   - 백엔드 서비스 인스턴스를 등록하여, API Gateway가 요청을 라우팅할 수 있도록 합니다.
     ```elixir
     ApiGateway.add_backend({:backend1, "http://backend1.example.com"})
     ApiGateway.add_backend({:backend2, "http://backend2.example.com"})
     ```

4. **API 요청 전송 및 테스트**
   - 클라이언트 또는 테스트 스크립트를 통해 API 요청을 전송합니다.
     ```elixir
     response = ApiGateway.route_request({:get, "/api/data", []})
     IO.puts("API 응답: #{inspect(response)}")
     ```

5. **헬스 체크 및 분산 클러스터 구성 (선택 사항)**
   - 서비스 헬스 체크 기능을 통해 각 백엔드 인스턴스의 상태를 확인하고, 장애 시 자동으로 요청을 전환합니다.
   - 여러 노드를 연결하여 분산 클러스터 환경에서 테스트할 수 있습니다.
     ```elixir
     Node.connect(:"node2@hostname")
     ApiGateway.sync_backends()
     ```

---

## 코드 구조

- **src/api_gateway.ex:**  
  API Gateway의 핵심 로직을 구현한 모듈로, 클라이언트 요청 수신, 라우팅, 백엔드 서비스 등록 및 관리 기능이 포함되어 있습니다.
  
- **src/load_balancer.ex:**  
  로드 밸런싱 알고리즘과 헬스 체크 로직을 구현한 모듈로, 백엔드 인스턴스에 요청을 분배하는 역할을 합니다.
  
- **src/health_check.ex:**  
  백엔드 서비스의 상태를 주기적으로 점검하고, 헬스 체크 결과에 따라 서비스 인스턴스를 관리합니다.
  
- **src/supervisor_gateway.ex:**  
  Supervisor 트리를 구성하여, API Gateway, 로드 밸런서 및 헬스 체크 프로세스의 생명주기를 관리합니다.
  
- **README.md:**  
  이 문서는 프로젝트 개요, 설치 및 실행 방법, 시스템 아키텍처, 코드 구조, 예제 사용 시나리오, 개발 및 확장 계획 등을 상세히 설명합니다.

---

## 예제 사용 시나리오

1. **시스템 시작:**  
   `ApiGateway.start()`를 통해 API Gateway 시스템을 초기화하고, 클라이언트 요청 수신 준비를 합니다.
   
2. **백엔드 등록:**  
   여러 백엔드 인스턴스를 등록하여, 동적 요청 라우팅이 가능하도록 합니다.
   
3. **API 요청 라우팅:**  
   클라이언트에서 전송된 API 요청이 로드 밸런서 알고리즘에 따라 적절한 백엔드로 전달됩니다.
   
4. **헬스 체크 및 장애 대응:**  
   헬스 체크 모듈이 각 백엔드 인스턴스의 상태를 점검하고, 장애 발생 시 Supervisor가 자동으로 재시작하여 서비스 연속성을 보장합니다.
   
5. **분산 클러스터 구성:**  
   여러 노드를 연결하여 분산 환경에서 API 요청 라우팅과 로드 밸런싱 기능을 테스트할 수 있습니다.

---

## 개발 및 확장 계획

- **동적 백엔드 등록 및 제거:**  
  운영 중인 백엔드 인스턴스를 실시간으로 추가하거나 제거하는 기능을 도입하여, 서비스 확장성과 유연성을 강화합니다.
  
- **정교한 로드 밸런싱 알고리즘:**  
  응답 시간, 부하 상태, 에러율 등을 고려한 고급 로드 밸런싱 알고리즘을 적용하여, 요청 분배의 효율성을 극대화합니다.
  
- **외부 헬스 체크 및 알림 연동:**  
  각 백엔드 서비스의 상태를 외부 모니터링 시스템과 연동하고, 장애 발생 시 이메일, SMS, 슬랙 등 다양한 채널로 알림을 전송하는 기능을 추가합니다.
  
- **보안 강화:**  
  API 요청 인증, SSL/TLS 암호화, 접근 제어 기능을 도입하여, 보안에 민감한 환경에서도 안전하게 운영될 수 있도록 합니다.
  
- **웹 기반 대시보드:**  
  실시간 API 트래픽, 백엔드 상태, 로드 밸런싱 성능 등을 시각화한 웹 대시보드를 개발하여, 운영자가 시스템 상태를 쉽게 모니터링하고 제어할 수 있도록 합니다.

---

## 참고 자료

- [Programming Erlang - Joe Armstrong](https://pragprog.com/titles/jjoe/programming-erlang/)
- [Learn You Some Erlang for Great Good! - Fred Hebert](http://learnyousomeerlang.com/)
- [Elixir 공식 문서](https://hexdocs.pm/elixir/)
- [OTP Design Principles](https://erlang.org/doc/design_principles/)

---

이 프로젝트는 OTP와 Elixir의 핵심 개념을 실전에서 적용해보며, 분산 환경에서 API 요청을 효율적으로 관리하는 방법을 배울 수 있는 훌륭한 예제입니다.  
분산 키-값 저장소와는 달리, 본 프로젝트는 API Gateway 및 로드 밸런싱에 초점을 맞추어, 대규모 트래픽 처리와 동적 서비스 관리의 실무 적용 가능성을 검증할 수 있도록 설계되었습니다.

의견이나 개선 사항은 [이슈 트래커](https://github.com/your-repo/api-gateway-load-balancer/issues)를 통해 공유해 주시기 바랍니다.

Happy coding!
