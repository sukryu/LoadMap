# IoT 메시지 브로커 프로젝트

## 프로젝트 개요
이 프로젝트는 Erlang/OTP의 고동시성, 분산 처리 및 fault-tolerance 기능을 활용하여 **IoT 메시지 브로커**를 구현한 예제입니다.  
본 시스템은 다양한 IoT 기기들이 생성하는 데이터를 수집, 라우팅 및 전달하는 역할을 수행하며, 대규모 IoT 환경에서 실시간 데이터 스트림을 효율적으로 처리할 수 있도록 설계되었습니다.

## 주요 기능
- **실시간 메시지 라우팅:**  
  다수의 IoT 기기에서 전송되는 데이터를 중앙 브로커가 수신하고, 구독자 또는 대상 서비스로 실시간 전파합니다.
- **고동시성 처리:**  
  Erlang의 경량 프로세스와 OTP의 supervisor 트리를 활용하여 수많은 메시지를 동시에 처리하며, 기기 수가 급증해도 안정적인 성능을 보장합니다.
- **오류 복구 및 자동 재시작:**  
  각 프로세스의 실패가 전체 시스템에 영향을 미치지 않도록 Supervisor가 자동으로 재시작하여 시스템 안정성을 유지합니다.
- **분산 통신 지원:**  
  여러 노드에 걸쳐 브로커를 확장함으로써, 대규모 IoT 네트워크에서도 데이터 처리와 메시지 라우팅을 원활하게 수행할 수 있습니다.
- **확장성 및 유연성:**  
  클러스터 환경에서 노드를 추가하거나 제거하는 방식으로, 실시간 트래픽 변화에 신속히 대응할 수 있습니다.

## 시스템 아키텍처
프로젝트는 OTP의 핵심 구성 요소들을 활용하여 다음과 같이 구성됩니다.

### 프로세스 구조
- **메시지 브로커 서버:**  
  IoT 기기 및 클라이언트로부터 메시지를 수신하고, 적절한 대상에게 라우팅하는 중앙 역할을 수행합니다.
- **메시지 핸들러 프로세스:**  
  개별 메시지를 처리하며, 메시지 포맷의 변환, 필터링, 우선순위 설정 등을 담당합니다.
- **클라이언트/서버 통신 모듈:**  
  MQTT, CoAP 또는 HTTP와 같은 프로토콜을 통해 IoT 기기와의 통신을 지원합니다.
- **Supervisor 트리:**  
  메시지 브로커와 핸들러 프로세스의 생명주기를 관리하며, 장애 발생 시 자동 복구 및 재시작을 수행합니다.

### OTP 구성 요소 활용
- **gen_server:**  
  메시지 수신, 처리 및 클라이언트와의 상호작용을 위한 서버 로직을 구현합니다.
- **supervisor:**  
  브로커와 핸들러 프로세스의 장애를 감시하고, 실패 시 자동 재시작하는 전략을 적용합니다.
- **분산 처리:**  
  여러 노드 간의 메시지 라우팅과 데이터 동기화를 위해 Erlang의 분산 기능을 활용합니다.

## 설치 및 실행 방법

### 요구 사항
- Erlang/OTP 24 이상
- Linux, macOS 또는 Windows 운영체제
- IoT 기기와의 통신을 위한 네트워크 환경

### 설치 방법

1. **Erlang/OTP 설치**
   - **Ubuntu/Debian:**
     ```bash
     sudo apt-get update
     sudo apt-get install erlang
     ```
   - **macOS:**
     ```bash
     brew install erlang
     ```
   - **Windows:**
     - Erlang 공식 웹사이트에서 인스톨러를 다운로드하거나, Chocolatey를 통해 설치:
       ```bash
       choco install erlang
       ```

2. **프로젝트 클론**
   ```bash
   git clone https://github.com/your-repo/iot-message-broker.git
   cd iot-message-broker
   ```

3. **컴파일**
   - `src` 디렉토리에 있는 Erlang 소스 파일들을 컴파일하여 `ebin` 디렉토리에 출력합니다.
     ```bash
     erlc -o ebin src/*.erl
     ```

### 실행 방법

1. **Erlang 쉘 시작**
   ```bash
   erl -pa ebin
   ```

2. **메시지 브로커 서버 시작**
   - Erlang 쉘에서 메시지 브로커 서버를 시작합니다.
     ```erlang
     iot_message_broker:start().
     ```
   - 서버는 IoT 기기와 클라이언트의 메시지를 수신하고 라우팅할 준비를 합니다.

3. **IoT 기기/클라이언트 연결**
   - 별도의 터미널이나 노드에서 IoT 기기 시뮬레이터 혹은 클라이언트 모듈을 실행하여 브로커에 접속합니다.
     ```erlang
     iot_client:start().
     ```
   - 클라이언트는 브로커와 연결되어 실시간 데이터 스트림을 주고받을 수 있습니다.

4. **메시지 전송 및 처리**
   - IoT 기기 시뮬레이터를 통해 데이터를 전송하면, 브로커는 해당 데이터를 수신하고 적절한 메시지 핸들러를 통해 처리 후 대상 클라이언트로 전달합니다.

## 코드 구조

- **src/iot_message_broker.erl:**  
  메시지 브로커의 핵심 로직을 구현한 모듈로, 메시지 수신, 처리, 라우팅 기능을 포함합니다.
  
- **src/iot_handler.erl:**  
  개별 메시지의 처리 및 변환을 담당하는 모듈로, 메시지 필터링과 우선순위 처리 등의 기능을 구현합니다.
  
- **src/iot_client.erl:**  
  브로커와 통신하여 메시지를 전송하고, 수신된 메시지를 표시하는 IoT 클라이언트 시뮬레이터 모듈입니다.
  
- **src/supervisor_iot.erl:**  
  Supervisor 트리를 구성하여, 메시지 브로커 및 핸들러 프로세스의 생명주기를 관리합니다.
  
- **README.md:**  
  이 문서로, 프로젝트 개요와 실행 방법, 시스템 아키텍처 등을 상세히 설명합니다.

## 예제 사용 시나리오
1. **브로커 시작:**  
   메시지 브로커 서버를 실행하여 IoT 기기와 클라이언트의 연결을 대기합니다.
2. **기기 및 클라이언트 접속:**  
   여러 IoT 기기와 클라이언트가 브로커에 접속하여 데이터를 송수신합니다.
3. **메시지 라우팅 및 처리:**  
   전송된 메시지는 브로커에 의해 수신되어, 메시지 핸들러를 통해 적절하게 처리된 후, 대상 클라이언트에게 전달됩니다.
4. **장애 복구:**  
   개별 프로세스나 노드에서 장애 발생 시, Supervisor가 자동으로 재시작하여 시스템 안정성을 유지합니다.

## 개발 및 테스트
- **개발 환경:**  
  Erlang/OTP R24 이상, VSCode 또는 기타 Erlang 지원 IDE
- **테스트:**  
  각 모듈에 대해 단위 테스트와 통합 테스트를 수행하여, 메시지 처리 및 라우팅 기능과 클러스터 환경에서의 동작을 검증합니다.
- **모니터링:**  
  로그 파일 및 실시간 모니터링 도구를 통해 시스템 성능과 장애 복구 상태를 확인합니다.

## 확장 계획
- **프로토콜 확장:**  
  MQTT, CoAP 등 다양한 IoT 통신 프로토콜 지원을 추가하여 기기 호환성을 강화합니다.
- **보안 강화:**  
  TLS 암호화, 기기 인증, 접근 제어 등을 도입하여 보안을 강화합니다.
- **웹 기반 대시보드:**  
  실시간 모니터링 및 제어를 위한 웹 인터페이스 개발을 통해, 관리자 편의성을 증대합니다.
- **데이터 분석 통합:**  
  수집된 메시지 데이터를 기반으로 한 분석 모듈 추가로, IoT 데이터 활용도를 높입니다.

## 참고 자료
- [Programming Erlang - Joe Armstrong](https://pragprog.com/titles/jjoe/programming-erlang/)
- [Learn You Some Erlang for Great Good! - Fred Hebert](http://learnyousomeerlang.com/)
- [Erlang 공식 문서](https://www.erlang.org/docs)
- [MQTT 프로토콜 소개](http://mqtt.org/)

---

이 프로젝트는 IoT 환경에서의 실시간 메시지 처리와 라우팅, 그리고 OTP 기반의 고가용성 시스템 구축을 실전에서 경험할 수 있는 훌륭한 예제입니다.  
의견이나 개선 사항은 [이슈 트래커](https://github.com/your-repo/iot-message-broker/issues)를 통해 공유해 주시기 바랍니다.

Happy coding!